<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Shrun.Data.Text</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier">UnlinedText</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Creation</span></span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Shrun.Data.Text.html#fromText"><span class="hs-identifier">fromText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Shrun.Data.Text.html#fromTextReplace"><span class="hs-identifier">fromTextReplace</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Shrun.Data.Text.html#unsafeUnlinedText"><span class="hs-identifier">unsafeUnlinedText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Elimination</span></span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Shrun.Data.Text.html#toText"><span class="hs-identifier">toText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Functions</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Shrun.Data.Text.html#concat"><span class="hs-identifier">concat</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Shrun.Data.Text.html#intercalate"><span class="hs-identifier">intercalate</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Shrun.Data.Text.html#reallyUnsafeLiftUnlined"><span class="hs-identifier">reallyUnsafeLiftUnlined</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IsString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromString</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Prelude.html"><span class="hs-identifier">Shrun.Prelude</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-comment">-- | Text after it has had all lines separated into different texts. We</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- introduce a newtype for clarity. The idea is that when we read arbitrary</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- text from a handle, this type serves as a witness that we have indeed split</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- the string along newlines. Then, in the normal case, we log each line</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- separately.</span><span>
</span><span id="line-30"></span><span class="hs-comment">--</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- In exceptional cases (e.g. command names), we may choose to combine the</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- list back into a single text, according to some logic.</span><span>
</span><span id="line-33"></span><span class="hs-comment">--</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- The constructor 'UnsafeUnlinedText' should only be used when we __know__</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- the text has no newlines and performance means a branch is undesirable</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- (e.g. streaming). If there is no performance impact, consider</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- 'unsafeUnlinedText' instead.</span><span>
</span><span id="line-38"></span><span class="hs-keyword">newtype</span><span> </span><span id="UnlinedText"><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-var">UnlinedText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UnsafeUnlinedText"><span class="annot"><a href="Shrun.Data.Text.html#UnsafeUnlinedText"><span class="hs-identifier hs-var">UnsafeUnlinedText</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unUnlinedText"><span class="annot"><span class="annottext">UnlinedText -&gt; Text
</span><a href="Shrun.Data.Text.html#unUnlinedText"><span class="hs-identifier hs-var hs-var">unUnlinedText</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">}</span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679519745"><span id="local-6989586621679519749"><span class="annot"><span class="annottext">UnlinedText -&gt; UnlinedText -&gt; Bool
(UnlinedText -&gt; UnlinedText -&gt; Bool)
-&gt; (UnlinedText -&gt; UnlinedText -&gt; Bool) -&gt; Eq UnlinedText
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: UnlinedText -&gt; UnlinedText -&gt; Bool
== :: UnlinedText -&gt; UnlinedText -&gt; Bool
$c/= :: UnlinedText -&gt; UnlinedText -&gt; Bool
/= :: UnlinedText -&gt; UnlinedText -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679519754"><span id="local-6989586621679519760"><span id="local-6989586621679519764"><span class="annot"><span class="annottext">Int -&gt; UnlinedText -&gt; ShowS
[UnlinedText] -&gt; ShowS
UnlinedText -&gt; String
(Int -&gt; UnlinedText -&gt; ShowS)
-&gt; (UnlinedText -&gt; String)
-&gt; ([UnlinedText] -&gt; ShowS)
-&gt; Show UnlinedText
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; UnlinedText -&gt; ShowS
showsPrec :: Int -&gt; UnlinedText -&gt; ShowS
$cshow :: UnlinedText -&gt; String
show :: UnlinedText -&gt; String
$cshowList :: [UnlinedText] -&gt; ShowS
showList :: [UnlinedText] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679519771"><span id="local-6989586621679519776"><span id="local-6989586621679519780"><span class="annot"><span class="annottext">Semigroup UnlinedText
UnlinedText
Semigroup UnlinedText =&gt;
UnlinedText
-&gt; (UnlinedText -&gt; UnlinedText -&gt; UnlinedText)
-&gt; ([UnlinedText] -&gt; UnlinedText)
-&gt; Monoid UnlinedText
[UnlinedText] -&gt; UnlinedText
UnlinedText -&gt; UnlinedText -&gt; UnlinedText
forall a.
Semigroup a =&gt;
a -&gt; (a -&gt; a -&gt; a) -&gt; ([a] -&gt; a) -&gt; Monoid a
$cmempty :: UnlinedText
mempty :: UnlinedText
$cmappend :: UnlinedText -&gt; UnlinedText -&gt; UnlinedText
mappend :: UnlinedText -&gt; UnlinedText -&gt; UnlinedText
$cmconcat :: [UnlinedText] -&gt; UnlinedText
mconcat :: [UnlinedText] -&gt; UnlinedText
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monoid</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679519786"><span id="local-6989586621679519791"><span id="local-6989586621679519797"><span class="annot"><span class="annottext">NonEmpty UnlinedText -&gt; UnlinedText
UnlinedText -&gt; UnlinedText -&gt; UnlinedText
(UnlinedText -&gt; UnlinedText -&gt; UnlinedText)
-&gt; (NonEmpty UnlinedText -&gt; UnlinedText)
-&gt; (forall b. Integral b =&gt; b -&gt; UnlinedText -&gt; UnlinedText)
-&gt; Semigroup UnlinedText
forall b. Integral b =&gt; b -&gt; UnlinedText -&gt; UnlinedText
forall a.
(a -&gt; a -&gt; a)
-&gt; (NonEmpty a -&gt; a)
-&gt; (forall b. Integral b =&gt; b -&gt; a -&gt; a)
-&gt; Semigroup a
$c&lt;&gt; :: UnlinedText -&gt; UnlinedText -&gt; UnlinedText
&lt;&gt; :: UnlinedText -&gt; UnlinedText -&gt; UnlinedText
$csconcat :: NonEmpty UnlinedText -&gt; UnlinedText
sconcat :: NonEmpty UnlinedText -&gt; UnlinedText
$cstimes :: forall b. Integral b =&gt; b -&gt; UnlinedText -&gt; UnlinedText
stimes :: forall b. Integral b =&gt; b -&gt; UnlinedText -&gt; UnlinedText
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Semigroup</span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-43"></span><span>  </span><span id="local-6989586621679519806"><span class="annot"><span class="annottext">fromString :: String -&gt; UnlinedText
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fromString</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#fromTextReplace"><span class="hs-identifier hs-var">fromTextReplace</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; UnlinedText) -&gt; (String -&gt; Text) -&gt; String -&gt; UnlinedText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">pack</span></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-46"></span><span>  </span><span id="local-6989586621679519666"><span id="local-6989586621679519667"><span id="local-6989586621679519668"><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621679519666"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Internal.Optic.Types.html#A_Getter"><span class="hs-identifier hs-type">A_Getter</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="#local-6989586621679519667"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><a href="#local-6989586621679519668"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Label.html#LabelOptic"><span class="hs-identifier hs-type">LabelOptic</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;unUnlinedText&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679519666"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519667"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679519668"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-52"></span><span>  </span><span id="local-6989586621679519817"><span class="annot"><span class="annottext">labelOptic :: Optic k NoIx UnlinedText UnlinedText a b
</span><a href="#local-6989586621679519817"><span class="hs-identifier hs-var hs-var hs-var hs-var">labelOptic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnlinedText -&gt; a) -&gt; Getter UnlinedText a
forall s a. (s -&gt; a) -&gt; Getter s a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Getter.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Data.Text.html#UnsafeUnlinedText"><span class="hs-identifier hs-type">UnsafeUnlinedText</span></a></span><span> </span><span id="local-6989586621679519820"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679519820"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
Text
</span><a href="#local-6989586621679519820"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Label.html#labelOptic"><span class="hs-pragma hs-type">labelOptic</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="annot"><span class="hs-comment">-- | Creates a list of 'UnlinedText'.</span></span><span>
</span><span id="line-56"></span><span class="annot"><a href="Shrun.Data.Text.html#fromText"><span class="hs-identifier hs-type">fromText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Shrun.Prelude.html#List"><span class="hs-identifier hs-type">List</span></a></span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span>
</span><span id="line-57"></span><span id="fromText"><span class="annot"><span class="annottext">fromText :: Text -&gt; [UnlinedText]
</span><a href="Shrun.Data.Text.html#fromText"><span class="hs-identifier hs-var hs-var">fromText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; UnlinedText) -&gt; [Text] -&gt; [UnlinedText]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#UnsafeUnlinedText"><span class="hs-identifier hs-var">UnsafeUnlinedText</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [UnlinedText])
-&gt; (Text -&gt; [Text]) -&gt; Text -&gt; [UnlinedText]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.lines</span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">-- | Creates a single 'UnlinedText' by replacing newlines with</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- whitespace.</span><span>
</span><span id="line-61"></span><span class="annot"><a href="Shrun.Data.Text.html#fromTextReplace"><span class="hs-identifier hs-type">fromTextReplace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span>
</span><span id="line-62"></span><span id="fromTextReplace"><span class="annot"><span class="annottext">fromTextReplace :: Text -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#fromTextReplace"><span class="hs-identifier hs-var hs-var">fromTextReplace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#UnsafeUnlinedText"><span class="hs-identifier hs-var">UnsafeUnlinedText</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; UnlinedText) -&gt; (Text -&gt; Text) -&gt; Text -&gt; UnlinedText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text -&gt; Text -&gt; Text
Text -&gt; Text -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.replace</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="annot"><span class="hs-comment">-- | Unsafe creation that throws error when the text contains newline(s).</span></span><span>
</span><span id="line-65"></span><span class="annot"><a href="Shrun.Data.Text.html#unsafeUnlinedText"><span class="hs-identifier hs-type">unsafeUnlinedText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span>
</span><span id="line-66"></span><span id="unsafeUnlinedText"><span class="annot"><span class="annottext">unsafeUnlinedText :: HasCallStack =&gt; Text -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#unsafeUnlinedText"><span class="hs-identifier hs-var hs-var">unsafeUnlinedText</span></a></span></span><span> </span><span id="local-6989586621679519832"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679519832"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\n'</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Text -&gt; Bool
</span><span class="hs-operator hs-var">`T.elem`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679519832"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; UnlinedText
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; UnlinedText) -&gt; String -&gt; UnlinedText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unwanted newline in text: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679519832"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#UnsafeUnlinedText"><span class="hs-identifier hs-var">UnsafeUnlinedText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679519832"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">-- NOTE: [Text Line Concatenation]</span><span>
</span><span id="line-72"></span><span class="hs-comment">--</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- Normally, we log multiple newlines separately. However in at least one</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- case, we want a single log: final error message. Why? Because we want</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- exactly one [Success]/[Error] log, so if we have multiple stderr lines,</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- we need to combine these into a single log.</span><span>
</span><span id="line-77"></span><span class="hs-comment">--</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- We have a choice on concatenation. We choose whitespace as the delimiter,</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- as newlines:</span><span>
</span><span id="line-80"></span><span class="hs-comment">--</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- 1. Will get stripped during formatting (happens after this is called).</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- 2. Even if we special case to avoid 1, newlines probably won't look good</span><span>
</span><span id="line-83"></span><span class="hs-comment">--    in the final output.</span><span>
</span><span id="line-84"></span><span class="annot"><a href="Shrun.Data.Text.html#toText"><span class="hs-identifier hs-type">toText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Shrun.Prelude.html#List"><span class="hs-identifier hs-type">List</span></a></span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-85"></span><span id="toText"><span class="annot"><span class="annottext">toText :: [UnlinedText] -&gt; Text
</span><a href="Shrun.Data.Text.html#toText"><span class="hs-identifier hs-var hs-var">toText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text)
-&gt; ([UnlinedText] -&gt; [Text]) -&gt; [UnlinedText] -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(UnlinedText -&gt; Text) -&gt; [UnlinedText] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic' A_Getter NoIx UnlinedText Text -&gt; UnlinedText -&gt; Text
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Getter NoIx UnlinedText Text
</span><span class="">#unUnlinedText</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><span class="hs-comment">-- | Concats via 'toText'.</span></span><span>
</span><span id="line-88"></span><span class="annot"><a href="Shrun.Data.Text.html#concat"><span class="hs-identifier hs-type">concat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Shrun.Prelude.html#List"><span class="hs-identifier hs-type">List</span></a></span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span>
</span><span id="line-89"></span><span id="concat"><span class="annot"><span class="annottext">concat :: [UnlinedText] -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#concat"><span class="hs-identifier hs-var hs-var">concat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#UnsafeUnlinedText"><span class="hs-identifier hs-var">UnsafeUnlinedText</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; UnlinedText)
-&gt; ([UnlinedText] -&gt; Text) -&gt; [UnlinedText] -&gt; UnlinedText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[UnlinedText] -&gt; Text
</span><a href="Shrun.Data.Text.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><a href="Shrun.Data.Text.html#intercalate"><span class="hs-identifier hs-type">intercalate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Shrun.Prelude.html#List"><span class="hs-identifier hs-type">List</span></a></span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span>
</span><span id="line-92"></span><span id="intercalate"><span class="annot"><span class="annottext">intercalate :: UnlinedText -&gt; [UnlinedText] -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#intercalate"><span class="hs-identifier hs-var hs-var">intercalate</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Data.Text.html#UnsafeUnlinedText"><span class="hs-identifier hs-type">UnsafeUnlinedText</span></a></span><span> </span><span id="local-6989586621679519838"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679519838"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#UnsafeUnlinedText"><span class="hs-identifier hs-var">UnsafeUnlinedText</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">(Text -&gt; UnlinedText)
-&gt; ([UnlinedText] -&gt; Text) -&gt; [UnlinedText] -&gt; UnlinedText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679519838"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="annottext">([Text] -&gt; Text)
-&gt; ([UnlinedText] -&gt; [Text]) -&gt; [UnlinedText] -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(UnlinedText -&gt; Text) -&gt; [UnlinedText] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic' A_Getter NoIx UnlinedText Text -&gt; UnlinedText -&gt; Text
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Getter NoIx UnlinedText Text
</span><span class="">#unUnlinedText</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">-- | Lifts a 'Text' function to 'UnlinedText'. Very unsafe in that we do not</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- check for errors i.e. if the parameter function introduces any newlines,</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- then this will silently succeed. This exists for performance.</span><span>
</span><span id="line-100"></span><span class="annot"><a href="Shrun.Data.Text.html#reallyUnsafeLiftUnlined"><span class="hs-identifier hs-type">reallyUnsafeLiftUnlined</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Shrun.Data.Text.html#UnlinedText"><span class="hs-identifier hs-type">UnlinedText</span></a></span><span>
</span><span id="line-101"></span><span id="reallyUnsafeLiftUnlined"><span class="annot"><span class="annottext">reallyUnsafeLiftUnlined :: (Text -&gt; Text) -&gt; UnlinedText -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#reallyUnsafeLiftUnlined"><span class="hs-identifier hs-var hs-var">reallyUnsafeLiftUnlined</span></a></span></span><span> </span><span id="local-6989586621679519839"><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621679519839"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Data.Text.html#UnsafeUnlinedText"><span class="hs-identifier hs-type">UnsafeUnlinedText</span></a></span><span> </span><span id="local-6989586621679519840"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679519840"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#UnsafeUnlinedText"><span class="hs-identifier hs-var">UnsafeUnlinedText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621679519839"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679519840"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span></pre></body></html>