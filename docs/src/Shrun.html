<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | This module is the entry point to the @Shrun@ library used by</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- the @Shrun@ executable.</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Shrun</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.ShellT.html#ShellT"><span class="hs-identifier">ShellT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Shrun.ShellT.html#runShellT"><span class="hs-identifier">runShellT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Shrun.html#shrun"><span class="hs-identifier">shrun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/kvb2yyq1yshfipcsvdmzc1iifbp4v38j-fdo-notify-0.3.1-doc/share/doc/fdo-notify-0.3.1/html/src/DBus.Notify.html"><span class="hs-identifier">DBus.Notify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/kvb2yyq1yshfipcsvdmzc1iifbp4v38j-fdo-notify-0.3.1-doc/share/doc/fdo-notify-0.3.1/html/src/DBus.Notify.html#UrgencyLevel"><span class="hs-identifier">UrgencyLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/kvb2yyq1yshfipcsvdmzc1iifbp4v38j-fdo-notify-0.3.1-doc/share/doc/fdo-notify-0.3.1/html/src/DBus.Notify.html#Critical"><span class="hs-identifier">Critical</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/kvb2yyq1yshfipcsvdmzc1iifbp4v38j-fdo-notify-0.3.1-doc/share/doc/fdo-notify-0.3.1/html/src/DBus.Notify.html#Normal"><span class="hs-identifier">Normal</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/2g2ycicahw77sclmzzbrim691gxz10lw-unordered-containers-0.2.20-doc/share/doc/unordered-containers-0.2.20/html/src/Data.HashSet.html"><span class="hs-identifier">Data.HashSet</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-39e959da60364930df1cb8c5cdf8238254801f4be9be7564365a2ec2c38d5ab0/share/doc/html/src/Effects.Concurrent.Async.html"><span class="hs-identifier">Effects.Concurrent.Async</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Async</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-thread-0.1-11ce15cb9eb5648ab1cfa155131e7e96f8382aa643017eb72fc799e6059083e1/share/doc/html/src/Effects.Concurrent.Thread.html"><span class="hs-identifier">Effects.Concurrent.Thread</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">X</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-thread-0.1-11ce15cb9eb5648ab1cfa155131e7e96f8382aa643017eb72fc799e6059083e1/share/doc/html/src/Effects.Concurrent.Thread.html#microsleep"><span class="hs-identifier">microsleep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-thread-0.1-11ce15cb9eb5648ab1cfa155131e7e96f8382aa643017eb72fc799e6059083e1/share/doc/html/src/Effects.Concurrent.Thread.html#sleep"><span class="hs-identifier">sleep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-time-0.1-2d36b70ff2ff08d46ea800f2a01319f93564f934493130e6fdcee8591d088979/share/doc/html/src/Effects.Time.html"><span class="hs-identifier">Effects.Time</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-time-0.1-2d36b70ff2ff08d46ea800f2a01319f93564f934493130e6fdcee8591d088979/share/doc/html/src/Effects.Time.html#TimeSpec"><span class="hs-identifier">TimeSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-time-0.1-2d36b70ff2ff08d46ea800f2a01319f93564f934493130e6fdcee8591d088979/share/doc/html/src/Effects.Time.html#withTiming"><span class="hs-identifier">withTiming</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Configuration.Data.ConsoleLogging.TimerFormat.html"><span class="hs-identifier">Shrun.Configuration.Data.ConsoleLogging.TimerFormat</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TimerFormat</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Configuration.Data.Core.Timeout.html"><span class="hs-identifier">Shrun.Configuration.Data.Core.Timeout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Configuration.Data.Core.Timeout.html#Timeout"><span class="hs-identifier">Timeout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Configuration.Data.Core.Timeout.html#MkTimeout"><span class="hs-identifier">MkTimeout</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Configuration.Data.FileLogging.html"><span class="hs-identifier">Shrun.Configuration.Data.FileLogging</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.Configuration.Data.FileLogging.html#FileLogOpened"><span class="hs-identifier">FileLogOpened</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Configuration.Data.FileLogging.html#MkFileLogOpened"><span class="hs-identifier">MkFileLogOpened</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Data.FileLogging.html#FileLoggingEnv"><span class="hs-identifier">FileLoggingEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html"><span class="hs-identifier">Shrun.Configuration.Env.Types</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasAnyError"><span class="hs-identifier">HasAnyError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#getAnyError"><span class="hs-identifier">getAnyError</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommandLogging"><span class="hs-identifier">HasCommandLogging</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommands"><span class="hs-identifier">HasCommands</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#getCommands"><span class="hs-identifier">getCommands</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#getCompletedCommands"><span class="hs-identifier">getCompletedCommands</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommonLogging"><span class="hs-identifier">HasCommonLogging</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#getCommonLogging"><span class="hs-identifier">getCommonLogging</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasConsoleLogging"><span class="hs-identifier">HasConsoleLogging</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#getConsoleLogging"><span class="hs-identifier">getConsoleLogging</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasFileLogging"><span class="hs-identifier">HasFileLogging</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#getFileLogging"><span class="hs-identifier">getFileLogging</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasInit"><span class="hs-identifier">HasInit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasNotifyConfig"><span class="hs-identifier">HasNotifyConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#getNotifyConfig"><span class="hs-identifier">getNotifyConfig</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasTimeout"><span class="hs-identifier">HasTimeout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#getTimeout"><span class="hs-identifier">getTimeout</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#setAnyErrorTrue"><span class="hs-identifier">setAnyErrorTrue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Data.Command.html"><span class="hs-identifier">Shrun.Data.Command</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Data.Command.html#CommandP1"><span class="hs-identifier">CommandP1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Data.Text.html"><span class="hs-identifier">Shrun.Data.Text</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ShrunText</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.IO.html"><span class="hs-identifier">Shrun.IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.IO.Types.html#Stderr"><span class="hs-identifier">Stderr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.IO.Types.html#MkStderr"><span class="hs-identifier">MkStderr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Shrun.IO.html#tryCommandLogging"><span class="hs-identifier">tryCommandLogging</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.IO.Types.html"><span class="hs-identifier">Shrun.IO.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.IO.Types.html#CommandResult"><span class="hs-identifier">CommandResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.IO.Types.html#CommandFailure"><span class="hs-identifier">CommandFailure</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Shrun.IO.Types.html#CommandSuccess"><span class="hs-identifier">CommandSuccess</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Logging.html"><span class="hs-identifier">Shrun.Logging</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Logging</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Logging.Formatting.html"><span class="hs-identifier">Shrun.Logging.Formatting</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LogFmt</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html"><span class="hs-identifier">Shrun.Logging.MonadRegionLogger</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#MonadRegionLogger"><span class="hs-identifier">MonadRegionLogger</span></a></span><span>
</span><span id="line-41"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier">Region</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>        </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#displayRegions"><span class="hs-identifier">displayRegions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#logGlobal"><span class="hs-identifier">logGlobal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#logRegion"><span class="hs-identifier">logRegion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#withRegion"><span class="hs-identifier">withRegion</span></a></span><span>
</span><span id="line-46"></span><span>      </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Logging.Types.html"><span class="hs-identifier">Shrun.Logging.Types</span></a></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.Logging.Types.Internal.html#FileLog"><span class="hs-identifier">FileLog</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="Shrun.Logging.Types.html#Log"><span class="hs-identifier">Log</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.Types.html#MkLog"><span class="hs-identifier">MkLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Shrun.Logging.Types.html#cmd"><span class="hs-identifier">cmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Shrun.Logging.Types.html#lvl"><span class="hs-identifier">lvl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Shrun.Logging.Types.html#mode"><span class="hs-identifier">mode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Shrun.Logging.Types.html#msg"><span class="hs-identifier">msg</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="Shrun.Logging.Types.html#LogLevel"><span class="hs-identifier">LogLevel</span></a></span><span>
</span><span id="line-52"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.Logging.Types.html#LevelError"><span class="hs-identifier">LevelError</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>        </span><span class="annot"><a href="Shrun.Logging.Types.html#LevelFatal"><span class="hs-identifier">LevelFatal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>        </span><span class="annot"><a href="Shrun.Logging.Types.html#LevelFinished"><span class="hs-identifier">LevelFinished</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>        </span><span class="annot"><a href="Shrun.Logging.Types.html#LevelSuccess"><span class="hs-identifier">LevelSuccess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>        </span><span class="annot"><a href="Shrun.Logging.Types.html#LevelTimer"><span class="hs-identifier">LevelTimer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>        </span><span class="annot"><a href="Shrun.Logging.Types.html#LevelWarn"><span class="hs-identifier">LevelWarn</span></a></span><span>
</span><span id="line-58"></span><span>      </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><a href="Shrun.Logging.Types.Internal.html#LogMode"><span class="hs-identifier">LogMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.Types.Internal.html#LogModeFinish"><span class="hs-identifier">LogModeFinish</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Shrun.Logging.Types.Internal.html#LogModeSet"><span class="hs-identifier">LogModeSet</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><a href="Shrun.Logging.Types.html#LogRegion"><span class="hs-identifier">LogRegion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.Types.html#LogNoRegion"><span class="hs-identifier">LogNoRegion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Shrun.Logging.Types.html#LogRegion"><span class="hs-identifier">LogRegion</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Notify.html"><span class="hs-identifier">Shrun.Notify</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Notify</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Notify.MonadNotify.html"><span class="hs-identifier">Shrun.Notify.MonadNotify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Notify.MonadNotify.html#MonadNotify"><span class="hs-identifier">MonadNotify</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Notify.Types.html"><span class="hs-identifier">Shrun.Notify.Types</span></a></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.Notify.Types.html#NotifyAction"><span class="hs-identifier">NotifyAction</span></a></span><span>
</span><span id="line-66"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.Notify.Types.html#NotifyAll"><span class="hs-identifier">NotifyAll</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>        </span><span class="annot"><a href="Shrun.Notify.Types.html#NotifyCommand"><span class="hs-identifier">NotifyCommand</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>        </span><span class="annot"><a href="Shrun.Notify.Types.html#NotifyFinal"><span class="hs-identifier">NotifyFinal</span></a></span><span>
</span><span id="line-69"></span><span>      </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Prelude.html"><span class="hs-identifier">Shrun.Prelude</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.ShellT.html"><span class="hs-identifier">Shrun.ShellT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.ShellT.html#ShellT"><span class="hs-identifier">ShellT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Shrun.ShellT.html#runShellT"><span class="hs-identifier">runShellT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Shrun.Utils.html"><span class="hs-identifier">Shrun.Utils</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/3782hxbhawvn3049pqvscrwhxw3aj1vw-scientific-0.3.7.0-doc/share/doc/scientific-0.3.7.0/html/src/Utils.html"><span class="hs-identifier">Utils</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="annot"><span class="hs-comment">-- | Entry point</span></span><span>
</span><span id="line-76"></span><span class="annot"><a href="Shrun.html#shrun"><span class="hs-identifier hs-type">shrun</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679536000"><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679535993"><span class="annot"><a href="#local-6989586621679535993"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasAnyError"><span class="hs-identifier hs-type">HasAnyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679535993"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommands"><span class="hs-identifier hs-type">HasCommands</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679535993"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasInit"><span class="hs-identifier hs-type">HasInit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679535993"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommandLogging"><span class="hs-identifier hs-type">HasCommandLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679535993"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommonLogging"><span class="hs-identifier hs-type">HasCommonLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679535993"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasConsoleLogging"><span class="hs-identifier hs-type">HasConsoleLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679535993"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasFileLogging"><span class="hs-identifier hs-type">HasFileLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679535993"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasNotifyConfig"><span class="hs-identifier hs-type">HasNotifyConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679535993"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasTimeout"><span class="hs-identifier hs-type">HasTimeout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679535993"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-39e959da60364930df1cb8c5cdf8238254801f4be9be7564365a2ec2c38d5ab0/share/doc/html/src/Effects.Concurrent.Async.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-41974851db458d24d7ece8322c69e073da21672623bf03800b727feccee8eadf/share/doc/html/src/Effects.FileSystem.HandleReader.html#MonadHandleReader"><span class="hs-identifier hs-type">MonadHandleReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-41974851db458d24d7ece8322c69e073da21672623bf03800b727feccee8eadf/share/doc/html/src/Effects.FileSystem.HandleWriter.html#MonadHandleWriter"><span class="hs-identifier hs-type">MonadHandleWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-ioref-0.1-860d8f404f53dca6781ee08a504921b2a5ad366cec6f6ee0bf36a6df9af5a101/share/doc/html/src/Effects.IORef.html#MonadIORef"><span class="hs-identifier hs-type">MonadIORef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><a href="Shrun.Notify.MonadNotify.html#MonadNotify"><span class="hs-identifier hs-type">MonadNotify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-typed-process-0.1-31e678bb34cc115b0fb9f823b4d3adb6e0d62694ea4adcda5e17b43bcf3a790e/share/doc/html/src/Effects.Process.Typed.html#MonadTypedProcess"><span class="hs-identifier hs-type">MonadTypedProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621679535993"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#MonadRegionLogger"><span class="hs-identifier hs-type">MonadRegionLogger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#MonadSTM"><span class="hs-identifier hs-type">MonadSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-thread-0.1-11ce15cb9eb5648ab1cfa155131e7e96f8382aa643017eb72fc799e6059083e1/share/doc/html/src/Effects.Concurrent.Thread.html#MonadThread"><span class="hs-identifier hs-type">MonadThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-time-0.1-2d36b70ff2ff08d46ea800f2a01319f93564f934493130e6fdcee8591d088979/share/doc/html/src/Effects.Time.html#MonadTime"><span class="hs-identifier hs-type">MonadTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><span class="hs-comment">-- | .</span></span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span id="shrun"><span class="annot"><span class="annottext">shrun :: forall (m :: Type -&gt; Type) env.
(HasAnyError env, HasCallStack, HasCommands env, HasInit env,
 HasCommandLogging env, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 HasNotifyConfig env, HasTimeout env, MonadAsync m,
 MonadHandleReader m, MonadHandleWriter m, MonadIORef m,
 MonadNotify m, MonadTypedProcess m, MonadMask m, MonadReader env m,
 MonadRegionLogger m, MonadSTM m, MonadThread m, MonadTime m) =&gt;
m ()
</span><a href="Shrun.html#shrun"><span class="hs-identifier hs-var hs-var">shrun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m ()
forall a. HasCallStack =&gt; m a -&gt; m a
forall (m :: Type -&gt; Type) a.
(MonadRegionLogger m, HasCallStack) =&gt;
m a -&gt; m a
</span><a href="Shrun.Logging.MonadRegionLogger.html#displayRegions"><span class="hs-identifier hs-var">displayRegions</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-104"></span><span>  </span><span id="local-6989586621679536450"><span class="annot"><span class="annottext">Maybe FileLoggingEnv
</span><a href="#local-6989586621679536450"><span class="hs-identifier hs-var">mFileLogging</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(env -&gt; Maybe FileLoggingEnv) -&gt; m (Maybe FileLoggingEnv)
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">env -&gt; Maybe FileLoggingEnv
forall env. HasFileLogging env =&gt; env -&gt; Maybe FileLoggingEnv
</span><a href="Shrun.Configuration.Env.Types.html#getFileLogging"><span class="hs-identifier hs-var">getFileLogging</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConsoleLoggingEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679536452"><span class="annot"><span class="annottext">TBQueue (LogRegion (Region m))
</span><a href="#local-6989586621679536452"><span class="hs-identifier hs-var">consoleQueue</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(env -&gt; (ConsoleLoggingEnv, TBQueue (LogRegion (Region m))))
-&gt; m (ConsoleLoggingEnv, TBQueue (LogRegion (Region m)))
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">env -&gt; (ConsoleLoggingEnv, TBQueue (LogRegion (Region m)))
forall env r.
HasConsoleLogging env r =&gt;
env -&gt; Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion r))
</span><a href="Shrun.Configuration.Env.Types.html#getConsoleLogging"><span class="hs-identifier hs-var">getConsoleLogging</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-comment">-- always start console logger</span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><span class="annottext">m Any -&gt; (Async Any -&gt; m ()) -&gt; m ()
forall a b. HasCallStack =&gt; m a -&gt; (Async a -&gt; m b) -&gt; m b
forall (m :: Type -&gt; Type) a b.
(MonadAsync m, HasCallStack) =&gt;
m a -&gt; (Async a -&gt; m b) -&gt; m b
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-39e959da60364930df1cb8c5cdf8238254801f4be9be7564365a2ec2c38d5ab0/share/doc/html/src/Effects.Concurrent.Async.html#withAsync"><span class="hs-identifier hs-var">Async.withAsync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TBQueue (LogRegion (Region m)) -&gt; m Any
forall (m :: Type -&gt; Type) env void.
(HasCallStack, MonadMask m, MonadReader env m, MonadRegionLogger m,
 MonadSTM m) =&gt;
TBQueue (LogRegion (Region m)) -&gt; m void
</span><a href="Shrun.html#pollQueueToConsole"><span class="hs-identifier hs-var">pollQueueToConsole</span></a></span><span> </span><span class="annot"><span class="annottext">TBQueue (LogRegion (Region m))
</span><a href="#local-6989586621679536452"><span class="hs-identifier hs-var">consoleQueue</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Async Any -&gt; m ()) -&gt; m ()) -&gt; (Async Any -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679536455"><span class="annot"><span class="annottext">Async Any
</span><a href="#local-6989586621679536455"><span class="hs-identifier hs-var">consoleLogger</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-comment">-- run commands, running file logger if requested</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="annottext">m () -&gt; (FileLoggingEnv -&gt; m ()) -&gt; Maybe FileLoggingEnv -&gt; m ()
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><span class="annottext">m ()
HasCallStack =&gt; m ()
</span><a href="#local-6989586621679536457"><span class="hs-identifier hs-var">runCommands</span></a></span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><span class="annottext">HasCallStack =&gt; FileLoggingEnv -&gt; m ()
FileLoggingEnv -&gt; m ()
</span><a href="#local-6989586621679536458"><span class="hs-identifier hs-var">runWithFileLogging</span></a></span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="annottext">Maybe FileLoggingEnv
</span><a href="#local-6989586621679536450"><span class="hs-identifier hs-var">mFileLogging</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-comment">-- cancel consoleLogger, print remaining logs</span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="annottext">Async Any -&gt; m ()
forall a. HasCallStack =&gt; Async a -&gt; m ()
forall (m :: Type -&gt; Type) a.
(MonadAsync m, HasCallStack) =&gt;
Async a -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-39e959da60364930df1cb8c5cdf8238254801f4be9be7564365a2ec2c38d5ab0/share/doc/html/src/Effects.Concurrent.Async.html#cancel"><span class="hs-identifier hs-var">Async.cancel</span></a></span><span> </span><span class="annot"><span class="annottext">Async Any
</span><a href="#local-6989586621679536455"><span class="hs-identifier hs-var">consoleLogger</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><span class="annottext">TBQueue (LogRegion (Region m)) -&gt; m [LogRegion (Region m)]
forall (m :: Type -&gt; Type) a.
(HasCallStack, MonadSTM m) =&gt;
TBQueue a -&gt; m [a]
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#flushTBQueueA"><span class="hs-identifier hs-var">flushTBQueueA</span></a></span><span> </span><span class="annot"><span class="annottext">TBQueue (LogRegion (Region m))
</span><a href="#local-6989586621679536452"><span class="hs-identifier hs-var">consoleQueue</span></a></span><span> </span><span class="annot"><span class="annottext">m [LogRegion (Region m)]
-&gt; ([LogRegion (Region m)] -&gt; m ()) -&gt; m ()
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: Type -&gt; Type) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">(LogRegion (Region m) -&gt; m ()) -&gt; [LogRegion (Region m)] -&gt; m ()
forall (t :: Type -&gt; Type) (f :: Type -&gt; Type) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="annot"><span class="annottext">LogRegion (Region m) -&gt; m ()
forall (m :: Type -&gt; Type).
(HasCallStack, MonadRegionLogger m) =&gt;
LogRegion (Region m) -&gt; m ()
</span><a href="Shrun.html#printConsoleLog"><span class="hs-identifier hs-var">printConsoleLog</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-comment">-- if any processes have failed, exit with an error</span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621679536463"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679536463"><span class="hs-identifier hs-var">anyError</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar Bool -&gt; m Bool
forall (m :: Type -&gt; Type) a.
(HasCallStack, MonadSTM m) =&gt;
TVar a -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#readTVarA"><span class="hs-identifier hs-var">readTVarA</span></a></span><span> </span><span class="annot"><span class="annottext">(TVar Bool -&gt; m Bool) -&gt; m (TVar Bool) -&gt; m Bool
forall (m :: Type -&gt; Type) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(env -&gt; TVar Bool) -&gt; m (TVar Bool)
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">env -&gt; TVar Bool
forall env. HasAnyError env =&gt; env -&gt; TVar Bool
</span><a href="Shrun.Configuration.Env.Types.html#getAnyError"><span class="hs-identifier hs-var">getAnyError</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: Type -&gt; Type). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679536463"><span class="hs-identifier hs-var">anyError</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
forall (m :: Type -&gt; Type) a. (HasCallStack, MonadThrow m) =&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-exceptions-0.1-6d7345700b9be135deb9c3a997e2b048c942bb4c528a6b7cecee0f81aca67dea/share/doc/html/src/Effects.Exception.html#exitFailure"><span class="hs-identifier hs-var">exitFailure</span></a></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><a href="#local-6989586621679536458"><span class="hs-identifier hs-type">runWithFileLogging</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Shrun.Configuration.Data.FileLogging.html#FileLoggingEnv"><span class="hs-identifier hs-type">FileLoggingEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679536458"><span class="annot"><span class="annottext">runWithFileLogging :: HasCallStack =&gt; FileLoggingEnv -&gt; m ()
</span><a href="#local-6989586621679536458"><span class="hs-identifier hs-var hs-var">runWithFileLogging</span></a></span></span><span> </span><span id="local-6989586621679536510"><span class="annot"><span class="annottext">FileLoggingEnv
</span><a href="#local-6989586621679536510"><span class="hs-identifier hs-var">fileLogging</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-125"></span><span>      </span><span class="annot"><span class="annottext">m Any -&gt; (Async Any -&gt; m ()) -&gt; m ()
forall a b. HasCallStack =&gt; m a -&gt; (Async a -&gt; m b) -&gt; m b
forall (m :: Type -&gt; Type) a b.
(MonadAsync m, HasCallStack) =&gt;
m a -&gt; (Async a -&gt; m b) -&gt; m b
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-39e959da60364930df1cb8c5cdf8238254801f4be9be7564365a2ec2c38d5ab0/share/doc/html/src/Effects.Concurrent.Async.html#withAsync"><span class="hs-identifier hs-var">Async.withAsync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FileLoggingEnv -&gt; m Any
forall (m :: Type -&gt; Type) void.
(HasCallStack, MonadHandleWriter m, MonadMask m, MonadSTM m) =&gt;
FileLoggingEnv -&gt; m void
</span><a href="Shrun.html#pollQueueToFile"><span class="hs-identifier hs-var">pollQueueToFile</span></a></span><span> </span><span class="annot"><span class="annottext">FileLoggingEnv
</span><a href="#local-6989586621679536510"><span class="hs-identifier hs-var">fileLogging</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Async Any -&gt; m ()) -&gt; m ()) -&gt; (Async Any -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679536512"><span class="annot"><span class="annottext">Async Any
</span><a href="#local-6989586621679536512"><span class="hs-identifier hs-var">fileLoggerThread</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><span class="annottext">m ()
HasCallStack =&gt; m ()
</span><a href="#local-6989586621679536457"><span class="hs-identifier hs-var">runCommands</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><span class="annottext">Async Any -&gt; m ()
forall a. HasCallStack =&gt; Async a -&gt; m ()
forall (m :: Type -&gt; Type) a.
(MonadAsync m, HasCallStack) =&gt;
Async a -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-39e959da60364930df1cb8c5cdf8238254801f4be9be7564365a2ec2c38d5ab0/share/doc/html/src/Effects.Concurrent.Async.html#cancel"><span class="hs-identifier hs-var">Async.cancel</span></a></span><span> </span><span class="annot"><span class="annottext">Async Any
</span><a href="#local-6989586621679536512"><span class="hs-identifier hs-var">fileLoggerThread</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>        </span><span class="hs-comment">-- handle any remaining file logs</span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><span class="annottext">TBQueue FileLog -&gt; m [FileLog]
forall (m :: Type -&gt; Type) a.
(HasCallStack, MonadSTM m) =&gt;
TBQueue a -&gt; m [a]
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#flushTBQueueA"><span class="hs-identifier hs-var">flushTBQueueA</span></a></span><span> </span><span class="annot"><span class="annottext">TBQueue FileLog
</span><a href="#local-6989586621679536513"><span class="hs-identifier hs-var">fileQueue</span></a></span><span> </span><span class="annot"><span class="annottext">m [FileLog] -&gt; ([FileLog] -&gt; m ()) -&gt; m ()
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: Type -&gt; Type) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">(FileLog -&gt; m ()) -&gt; [FileLog] -&gt; m ()
forall (t :: Type -&gt; Type) (f :: Type -&gt; Type) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; FileLog -&gt; m ()
forall (m :: Type -&gt; Type).
(HasCallStack, MonadHandleWriter m) =&gt;
Handle -&gt; FileLog -&gt; m ()
</span><a href="Shrun.html#logFile"><span class="hs-identifier hs-var">logFile</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679536515"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>        </span><span class="annot"><span class="annottext">Handle -&gt; m ()
forall (m :: Type -&gt; Type).
(MonadHandleWriter m, HasCallStack) =&gt;
Handle -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-41974851db458d24d7ece8322c69e073da21672623bf03800b727feccee8eadf/share/doc/html/src/Effects.FileSystem.HandleWriter.html#hFlush"><span class="hs-identifier hs-var">hFlush</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679536515"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-133"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><a href="Shrun.Configuration.Data.FileLogging.html#MkFileLogOpened"><span class="hs-identifier hs-type">MkFileLogOpened</span></a></span><span> </span><span id="local-6989586621679536515"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679536515"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679536513"><span class="annot"><span class="annottext">TBQueue FileLog
</span><a href="#local-6989586621679536513"><span class="hs-identifier hs-var">fileQueue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FileLoggingEnv
</span><a href="#local-6989586621679536510"><span class="hs-identifier hs-var">fileLogging</span></a></span><span> </span><span class="annot"><span class="annottext">FileLoggingEnv
-&gt; Optic' A_Lens NoIx FileLoggingEnv FileLogOpened -&gt; FileLogOpened
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx FileLoggingEnv FileLogOpened
</span><span class="">#file</span></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><a href="#local-6989586621679536457"><span class="hs-identifier hs-type">runCommands</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679536000"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621679536457"><span class="annot"><span class="annottext">runCommands :: HasCallStack =&gt; m ()
</span><a href="#local-6989586621679536457"><span class="hs-identifier hs-var hs-var">runCommands</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-138"></span><span>      </span><span id="local-6989586621679536583"><span class="annot"><span class="annottext">NESeq CommandP1
</span><a href="#local-6989586621679536583"><span class="hs-identifier hs-var">cmds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(env -&gt; NESeq CommandP1) -&gt; m (NESeq CommandP1)
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">env -&gt; NESeq CommandP1
forall env. HasCommands env =&gt; env -&gt; NESeq CommandP1
</span><a href="Shrun.Configuration.Env.Types.html#getCommands"><span class="hs-identifier hs-var">getCommands</span></a></span><span>
</span><span id="line-139"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679536584"><span class="annot"><span class="annottext">actions :: m ()
</span><a href="#local-6989586621679536584"><span class="hs-identifier hs-var hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CommandP1 -&gt; m ()) -&gt; NESeq CommandP1 -&gt; m ()
forall (m :: Type -&gt; Type) (f :: Type -&gt; Type) a b.
(MonadAsync m, Foldable f) =&gt;
(a -&gt; m b) -&gt; f a -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-39e959da60364930df1cb8c5cdf8238254801f4be9be7564365a2ec2c38d5ab0/share/doc/html/src/Effects.Concurrent.Async.html#mapConcurrently_"><span class="hs-identifier hs-var">Async.mapConcurrently_</span></a></span><span> </span><span class="annot"><span class="annottext">CommandP1 -&gt; m ()
forall (m :: Type -&gt; Type) env.
(HasAnyError env, HasCallStack, HasCommands env, HasInit env,
 HasCommandLogging env, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 HasNotifyConfig env, MonadHandleReader m, MonadIORef m,
 MonadMask m, MonadNotify m, MonadTypedProcess m, MonadReader env m,
 MonadRegionLogger m, MonadSTM m, MonadThread m, MonadTime m) =&gt;
CommandP1 -&gt; m ()
</span><a href="Shrun.html#runCommand"><span class="hs-identifier hs-var">runCommand</span></a></span><span> </span><span class="annot"><span class="annottext">NESeq CommandP1
</span><a href="#local-6989586621679536583"><span class="hs-identifier hs-var">cmds</span></a></span><span>
</span><span id="line-140"></span><span>          </span><span id="local-6989586621679536587"><span class="annot"><span class="annottext">actionsWithTimer :: m ()
</span><a href="#local-6989586621679536587"><span class="hs-identifier hs-var hs-var">actionsWithTimer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall (m :: Type -&gt; Type) a b.
(HasCallStack, MonadAsync m) =&gt;
m a -&gt; m b -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-39e959da60364930df1cb8c5cdf8238254801f4be9be7564365a2ec2c38d5ab0/share/doc/html/src/Effects.Concurrent.Async.html#race_"><span class="hs-identifier hs-var">Async.race_</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679536584"><span class="hs-identifier hs-var">actions</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
forall env (m :: Type -&gt; Type).
(HasAnyError env, HasCallStack, HasCommands env,
 HasCommonLogging env, HasConsoleLogging env (Region m),
 HasFileLogging env, HasTimeout env, MonadIORef m,
 MonadReader env m, MonadRegionLogger m, MonadSTM m, MonadThread m,
 MonadTime m) =&gt;
m ()
</span><a href="Shrun.html#counter"><span class="hs-identifier hs-var">counter</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679536590"><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679536590"><span class="hs-identifier hs-var">totalTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679536591"><span class="annot"><span class="annottext">Either SomeException ()
</span><a href="#local-6989586621679536591"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Either SomeException ())
-&gt; m (TimeSpec, Either SomeException ())
forall (m :: Type -&gt; Type) a.
(HasCallStack, MonadTime m) =&gt;
m a -&gt; m (TimeSpec, a)
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-time-0.1-2d36b70ff2ff08d46ea800f2a01319f93564f934493130e6fdcee8591d088979/share/doc/html/src/Effects.Time.html#withTiming"><span class="hs-identifier hs-var">withTiming</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either SomeException ())
 -&gt; m (TimeSpec, Either SomeException ()))
-&gt; m (Either SomeException ())
-&gt; m (TimeSpec, Either SomeException ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m (Either SomeException ())
forall (m :: Type -&gt; Type) a.
(HasCallStack, MonadCatch m) =&gt;
m a -&gt; m (Either SomeException a)
</span><a href="file:///nix/store/l0072641y03v7wfrca9v1lv596fpxxa7-safe-exceptions-0.1.7.4-doc/share/doc/safe-exceptions-0.1.7.4/html/src/Control.Exception.Safe.html#tryAny"><span class="hs-identifier hs-var">tryAny</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679536587"><span class="hs-identifier hs-var">actionsWithTimer</span></a></span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><span class="annottext">TimeSpec -&gt; Either SomeException () -&gt; m ()
forall (m :: Type -&gt; Type) env e b.
(Exception e, HasAnyError env, HasCallStack, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 HasNotifyConfig env, MonadNotify m, MonadReader env m,
 MonadRegionLogger m, MonadSTM m, MonadTime m) =&gt;
TimeSpec -&gt; Either e b -&gt; m ()
</span><a href="Shrun.html#printFinalResult"><span class="hs-identifier hs-var">printFinalResult</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679536590"><span class="hs-identifier hs-var">totalTime</span></a></span><span> </span><span class="annot"><span class="annottext">Either SomeException ()
</span><a href="#local-6989586621679536591"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><a href="Shrun.html#runCommand"><span class="hs-identifier hs-type">runCommand</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679536120"><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679536119"><span class="annot"><a href="#local-6989586621679536119"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasAnyError"><span class="hs-identifier hs-type">HasAnyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536119"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommands"><span class="hs-identifier hs-type">HasCommands</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536119"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasInit"><span class="hs-identifier hs-type">HasInit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536119"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommandLogging"><span class="hs-identifier hs-type">HasCommandLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536119"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommonLogging"><span class="hs-identifier hs-type">HasCommonLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536119"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasConsoleLogging"><span class="hs-identifier hs-type">HasConsoleLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536119"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasFileLogging"><span class="hs-identifier hs-type">HasFileLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536119"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasNotifyConfig"><span class="hs-identifier hs-type">HasNotifyConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536119"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-41974851db458d24d7ece8322c69e073da21672623bf03800b727feccee8eadf/share/doc/html/src/Effects.FileSystem.HandleReader.html#MonadHandleReader"><span class="hs-identifier hs-type">MonadHandleReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-ioref-0.1-860d8f404f53dca6781ee08a504921b2a5ad366cec6f6ee0bf36a6df9af5a101/share/doc/html/src/Effects.IORef.html#MonadIORef"><span class="hs-identifier hs-type">MonadIORef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><a href="Shrun.Notify.MonadNotify.html#MonadNotify"><span class="hs-identifier hs-type">MonadNotify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-typed-process-0.1-31e678bb34cc115b0fb9f823b4d3adb6e0d62694ea4adcda5e17b43bcf3a790e/share/doc/html/src/Effects.Process.Typed.html#MonadTypedProcess"><span class="hs-identifier hs-type">MonadTypedProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621679536119"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#MonadRegionLogger"><span class="hs-identifier hs-type">MonadRegionLogger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#MonadSTM"><span class="hs-identifier hs-type">MonadSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-thread-0.1-11ce15cb9eb5648ab1cfa155131e7e96f8382aa643017eb72fc799e6059083e1/share/doc/html/src/Effects.Concurrent.Thread.html#MonadThread"><span class="hs-identifier hs-type">MonadThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-time-0.1-2d36b70ff2ff08d46ea800f2a01319f93564f934493130e6fdcee8591d088979/share/doc/html/src/Effects.Time.html#MonadTime"><span class="hs-identifier hs-type">MonadTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><a href="Shrun.Data.Command.html#CommandP1"><span class="hs-identifier hs-type">CommandP1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span id="runCommand"><span class="annot"><span class="annottext">runCommand :: forall (m :: Type -&gt; Type) env.
(HasAnyError env, HasCallStack, HasCommands env, HasInit env,
 HasCommandLogging env, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 HasNotifyConfig env, MonadHandleReader m, MonadIORef m,
 MonadMask m, MonadNotify m, MonadTypedProcess m, MonadReader env m,
 MonadRegionLogger m, MonadSTM m, MonadThread m, MonadTime m) =&gt;
CommandP1 -&gt; m ()
</span><a href="Shrun.html#runCommand"><span class="hs-identifier hs-var hs-var">runCommand</span></a></span></span><span> </span><span id="local-6989586621679536746"><span class="annot"><span class="annottext">CommandP1
</span><a href="#local-6989586621679536746"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-170"></span><span>  </span><span id="local-6989586621679536747"><span class="annot"><span class="annottext">CommandResult
</span><a href="#local-6989586621679536747"><span class="hs-identifier hs-var">cmdResult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CommandP1 -&gt; m CommandResult
forall (m :: Type -&gt; Type) env.
(HasAnyError env, HasCallStack, HasCommands env, HasInit env,
 HasCommandLogging env, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 MonadHandleReader m, MonadIORef m, MonadMask m, MonadReader env m,
 MonadRegionLogger m, MonadSTM m, MonadThread m, MonadTime m,
 MonadTypedProcess m) =&gt;
CommandP1 -&gt; m CommandResult
</span><a href="Shrun.IO.html#tryCommandLogging"><span class="hs-identifier hs-var">tryCommandLogging</span></a></span><span> </span><span class="annot"><span class="annottext">CommandP1
</span><a href="#local-6989586621679536746"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span id="local-6989586621679536748"><span class="annot"><span class="annottext">CommonLoggingEnv
</span><a href="#local-6989586621679536748"><span class="hs-identifier hs-var">commonLogging</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(env -&gt; CommonLoggingEnv) -&gt; m CommonLoggingEnv
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">env -&gt; CommonLoggingEnv
forall env. HasCommonLogging env =&gt; env -&gt; CommonLoggingEnv
</span><a href="Shrun.Configuration.Env.Types.html#getCommonLogging"><span class="hs-identifier hs-var">getCommonLogging</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679536749"><span class="annot"><span class="annottext">ConsoleLoggingEnv
</span><a href="#local-6989586621679536749"><span class="hs-identifier hs-var">consoleLogging</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TBQueue (LogRegion (Region m))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(env -&gt; (ConsoleLoggingEnv, TBQueue (LogRegion (Region m))))
-&gt; m (ConsoleLoggingEnv, TBQueue (LogRegion (Region m)))
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall env r.
HasConsoleLogging env r =&gt;
env -&gt; Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion r))
</span><a href="Shrun.Configuration.Env.Types.html#getConsoleLogging"><span class="hs-identifier hs-var">getConsoleLogging</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679536119"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536120"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679536750"><span class="annot"><span class="annottext">timerFormat :: TimerFormat
</span><a href="#local-6989586621679536750"><span class="hs-identifier hs-var hs-var">timerFormat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConsoleLoggingEnv
</span><a href="#local-6989586621679536749"><span class="hs-identifier hs-var">consoleLogging</span></a></span><span> </span><span class="annot"><span class="annottext">ConsoleLoggingEnv
-&gt; Optic' A_Lens NoIx ConsoleLoggingEnv TimerFormat -&gt; TimerFormat
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx ConsoleLoggingEnv TimerFormat
</span><span class="">#timerFormat</span></span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679536751"><span class="annot"><span class="annottext">UrgencyLevel
</span><a href="#local-6989586621679536751"><span class="hs-identifier hs-var">urgency</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679536752"><span class="annot"><span class="annottext">UnlinedText
</span><a href="#local-6989586621679536752"><span class="hs-identifier hs-var">msg'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679536753"><span class="annot"><span class="annottext">LogLevel
</span><a href="#local-6989586621679536753"><span class="hs-identifier hs-var">lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679536754"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621679536754"><span class="hs-identifier hs-var">timeElapsed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CommandResult
</span><a href="#local-6989586621679536747"><span class="hs-identifier hs-var">cmdResult</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-comment">-- see NOTE: [Text Line Concatentation] for how we combine the</span><span>
</span><span id="line-177"></span><span>        </span><span class="hs-comment">-- multiple texts back into a single err.</span><span>
</span><span id="line-178"></span><span>        </span><span class="annot"><a href="Shrun.IO.Types.html#CommandFailure"><span class="hs-identifier hs-type">CommandFailure</span></a></span><span> </span><span id="local-6989586621679536755"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621679536755"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.IO.Types.html#MkStderr"><span class="hs-identifier hs-type">MkStderr</span></a></span><span> </span><span id="local-6989586621679536756"><span class="annot"><span class="annottext">List UnlinedText
</span><a href="#local-6989586621679536756"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-179"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679536757"><span class="annot"><span class="annottext">errMsg :: UnlinedText
</span><a href="#local-6989586621679536757"><span class="hs-identifier hs-var hs-var">errMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">List UnlinedText -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#concat"><span class="hs-identifier hs-var">ShrunText.concat</span></a></span><span> </span><span class="annot"><span class="annottext">List UnlinedText
</span><a href="#local-6989586621679536756"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-180"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrgencyLevel
</span><a href="file:///nix/store/kvb2yyq1yshfipcsvdmzc1iifbp4v38j-fdo-notify-0.3.1-doc/share/doc/fdo-notify-0.3.1/html/src/DBus.Notify.html#Critical"><span class="hs-identifier hs-var">Critical</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">UnlinedText -&gt; UnlinedText -&gt; UnlinedText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><a href="#local-6989586621679536757"><span class="hs-identifier hs-var">errMsg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Shrun.Logging.Types.html#LevelError"><span class="hs-identifier hs-var">LevelError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621679536755"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>        </span><span class="annot"><a href="Shrun.IO.Types.html#CommandSuccess"><span class="hs-identifier hs-type">CommandSuccess</span></a></span><span> </span><span id="local-6989586621679536759"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621679536759"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UrgencyLevel
</span><a href="file:///nix/store/kvb2yyq1yshfipcsvdmzc1iifbp4v38j-fdo-notify-0.3.1-doc/share/doc/fdo-notify-0.3.1/html/src/DBus.Notify.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Shrun.Logging.Types.html#LevelSuccess"><span class="hs-identifier hs-var">LevelSuccess</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621679536759"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>      </span><span id="local-6989586621679536760"><span class="annot"><span class="annottext">timeMsg :: UnlinedText
</span><a href="#local-6989586621679536760"><span class="hs-identifier hs-var hs-var">timeMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimerFormat -&gt; RelativeTime -&gt; UnlinedText
</span><a href="Shrun.Configuration.Data.ConsoleLogging.TimerFormat.html#formatRelativeTime"><span class="hs-identifier hs-var">TimerFormat.formatRelativeTime</span></a></span><span> </span><span class="annot"><span class="annottext">TimerFormat
</span><a href="#local-6989586621679536750"><span class="hs-identifier hs-var">timerFormat</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621679536754"><span class="hs-identifier hs-var">timeElapsed</span></a></span><span> </span><span class="annot"><span class="annottext">UnlinedText -&gt; UnlinedText -&gt; UnlinedText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><a href="#local-6989586621679536752"><span class="hs-identifier hs-var">msg'</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><span class="annottext">RegionLayout -&gt; (Region m -&gt; m ()) -&gt; m ()
forall a. HasCallStack =&gt; RegionLayout -&gt; (Region m -&gt; m a) -&gt; m a
forall (m :: Type -&gt; Type) a.
(MonadRegionLogger m, HasCallStack) =&gt;
RegionLayout -&gt; (Region m -&gt; m a) -&gt; m a
</span><a href="Shrun.Logging.MonadRegionLogger.html#withRegion"><span class="hs-identifier hs-var">withRegion</span></a></span><span> </span><span class="annot"><span class="annottext">RegionLayout
</span><a href="file:///nix/store/yxyj3l7g9hapmnbhjchbjsff5fqn4v74-concurrent-output-1.10.21-doc/share/doc/concurrent-output-1.10.21/html/src/System.Console.Regions.html#Linear"><span class="hs-identifier hs-var">Linear</span></a></span><span> </span><span class="annot"><span class="annottext">((Region m -&gt; m ()) -&gt; m ()) -&gt; (Region m -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679536763"><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679536763"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-185"></span><span>    </span><span class="annot"><span class="annottext">Region m -&gt; Log -&gt; m ()
forall env (m :: Type -&gt; Type).
(HasCallStack, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 MonadReader env m, MonadSTM m, MonadTime m) =&gt;
Region m -&gt; Log -&gt; m ()
</span><a href="Shrun.Logging.html#putRegionLog"><span class="hs-identifier hs-var">Logging.putRegionLog</span></a></span><span> </span><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679536763"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-186"></span><span>      </span><span class="annot"><span class="annottext">(Log -&gt; m ()) -&gt; Log -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Shrun.Logging.Types.html#MkLog"><span class="hs-identifier hs-type">MkLog</span></a></span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmd :: Maybe CommandP1
</span><a href="Shrun.Logging.Types.html#cmd"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandP1 -&gt; Maybe CommandP1
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CommandP1
</span><a href="#local-6989586621679536746"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-188"></span><span>          </span><span class="annot"><span class="annottext">msg :: UnlinedText
</span><a href="Shrun.Logging.Types.html#msg"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><a href="#local-6989586621679536760"><span class="hs-identifier hs-var">timeMsg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-189"></span><span>          </span><span class="annot"><span class="annottext">LogLevel
lvl :: LogLevel
lvl :: LogLevel
</span><a href="Shrun.Logging.Types.html#lvl"><span class="hs-identifier hs-var hs-var">lvl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-190"></span><span>          </span><span class="annot"><span class="annottext">mode :: LogMode
</span><a href="Shrun.Logging.Types.html#mode"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogMode
</span><a href="Shrun.Logging.Types.Internal.html#LogModeFinish"><span class="hs-identifier hs-var">LogModeFinish</span></a></span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679536765"><span class="annot"><span class="annottext">commandNameTrunc :: Maybe (Truncation 'TruncCommandName)
</span><a href="#local-6989586621679536765"><span class="hs-identifier hs-var hs-var">commandNameTrunc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConsoleLoggingEnv
</span><a href="#local-6989586621679536749"><span class="hs-identifier hs-var">consoleLogging</span></a></span><span> </span><span class="annot"><span class="annottext">ConsoleLoggingEnv
-&gt; Optic'
     A_Lens
     NoIx
     ConsoleLoggingEnv
     (Maybe (Truncation 'TruncCommandName))
-&gt; Maybe (Truncation 'TruncCommandName)
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Optic'
  A_Lens
  NoIx
  ConsoleLoggingEnv
  (Maybe (Truncation 'TruncCommandName))
</span><span class="">#commandNameTrunc</span></span><span>
</span><span id="line-194"></span><span>      </span><span id="local-6989586621679536766"><span class="annot"><span class="annottext">keyHide :: KeyHideSwitch
</span><a href="#local-6989586621679536766"><span class="hs-identifier hs-var hs-var">keyHide</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommonLoggingEnv
</span><a href="#local-6989586621679536748"><span class="hs-identifier hs-var">commonLogging</span></a></span><span> </span><span class="annot"><span class="annottext">CommonLoggingEnv
-&gt; Optic' An_Iso NoIx CommonLoggingEnv KeyHideSwitch
-&gt; KeyHideSwitch
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' An_Iso NoIx CommonLoggingEnv KeyHideSwitch
</span><span class="">#keyHide</span></span><span>
</span><span id="line-195"></span><span>      </span><span id="local-6989586621679536767"><span class="annot"><span class="annottext">formattedCmd :: UnlinedText
</span><a href="#local-6989586621679536767"><span class="hs-identifier hs-var hs-var">formattedCmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeyHideSwitch
-&gt; Maybe (Truncation 'TruncCommandName) -&gt; CommandP1 -&gt; UnlinedText
</span><a href="Shrun.Logging.Formatting.html#formatCommand"><span class="hs-identifier hs-var">LogFmt.formatCommand</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHideSwitch
</span><a href="#local-6989586621679536766"><span class="hs-identifier hs-var">keyHide</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Truncation 'TruncCommandName)
</span><a href="#local-6989586621679536765"><span class="hs-identifier hs-var">commandNameTrunc</span></a></span><span> </span><span class="annot"><span class="annottext">CommandP1
</span><a href="#local-6989586621679536746"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-comment">-- Sent off notif if NotifyAll or NotifyCommand is set</span><span>
</span><span id="line-198"></span><span>  </span><span id="local-6989586621679536769"><span class="annot"><span class="annottext">Maybe NotifyEnv
</span><a href="#local-6989586621679536769"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(env -&gt; Maybe NotifyEnv) -&gt; m (Maybe NotifyEnv)
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">env -&gt; Maybe NotifyEnv
forall env. HasNotifyConfig env =&gt; env -&gt; Maybe NotifyEnv
</span><a href="Shrun.Configuration.Env.Types.html#getNotifyConfig"><span class="hs-identifier hs-var">getNotifyConfig</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe NotifyEnv
</span><a href="#local-6989586621679536769"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NotifyEnv
-&gt; Optic' An_AffineTraversal NoIx (Maybe NotifyEnv) NotifyAction
-&gt; Maybe NotifyAction
forall k s (is :: IxList) a.
Is k An_AffineFold =&gt;
s -&gt; Optic' k is s a -&gt; Maybe a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E%3F"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Prism (Maybe NotifyEnv) (Maybe NotifyEnv) NotifyEnv NotifyEnv
forall a b. Prism (Maybe a) (Maybe b) a b
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Data.Maybe.Optics.html#_Just"><span class="hs-identifier hs-var">_Just</span></a></span><span> </span><span class="annot"><span class="annottext">Prism (Maybe NotifyEnv) (Maybe NotifyEnv) NotifyEnv NotifyEnv
-&gt; Optic A_Lens NoIx NotifyEnv NotifyEnv NotifyAction NotifyAction
-&gt; Optic' An_AffineTraversal NoIx (Maybe NotifyEnv) NotifyAction
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Internal.Optic.html#%25"><span class="hs-operator hs-var">%</span></a></span><span> </span><span class="annot"><span class="annottext">Optic A_Lens NoIx NotifyEnv NotifyEnv NotifyAction NotifyAction
</span><span class="">#action</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">NotifyAction
</span><a href="Shrun.Notify.Types.html#NotifyAll"><span class="hs-identifier hs-var">NotifyAll</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnlinedText -&gt; UnlinedText -&gt; UrgencyLevel -&gt; m ()
forall env (m :: Type -&gt; Type).
(HasAnyError env, HasCallStack, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 HasNotifyConfig env, MonadNotify m, MonadReader env m,
 MonadRegionLogger m, MonadSTM m, MonadTime m) =&gt;
UnlinedText -&gt; UnlinedText -&gt; UrgencyLevel -&gt; m ()
</span><a href="Shrun.Notify.html#sendNotif"><span class="hs-identifier hs-var">Notify.sendNotif</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnlinedText
</span><a href="#local-6989586621679536767"><span class="hs-identifier hs-var">formattedCmd</span></a></span><span> </span><span class="annot"><span class="annottext">UnlinedText -&gt; UnlinedText -&gt; UnlinedText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><span class="hs-string">&quot; Finished&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><a href="#local-6989586621679536760"><span class="hs-identifier hs-var">timeMsg</span></a></span><span> </span><span class="annot"><span class="annottext">UrgencyLevel
</span><a href="#local-6989586621679536751"><span class="hs-identifier hs-var">urgency</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">NotifyAction
</span><a href="Shrun.Notify.Types.html#NotifyCommand"><span class="hs-identifier hs-var">NotifyCommand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnlinedText -&gt; UnlinedText -&gt; UrgencyLevel -&gt; m ()
forall env (m :: Type -&gt; Type).
(HasAnyError env, HasCallStack, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 HasNotifyConfig env, MonadNotify m, MonadReader env m,
 MonadRegionLogger m, MonadSTM m, MonadTime m) =&gt;
UnlinedText -&gt; UnlinedText -&gt; UrgencyLevel -&gt; m ()
</span><a href="Shrun.Notify.html#sendNotif"><span class="hs-identifier hs-var">Notify.sendNotif</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnlinedText
</span><a href="#local-6989586621679536767"><span class="hs-identifier hs-var">formattedCmd</span></a></span><span> </span><span class="annot"><span class="annottext">UnlinedText -&gt; UnlinedText -&gt; UnlinedText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><span class="hs-string">&quot; Finished&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><a href="#local-6989586621679536760"><span class="hs-identifier hs-var">timeMsg</span></a></span><span> </span><span class="annot"><span class="annottext">UrgencyLevel
</span><a href="#local-6989586621679536751"><span class="hs-identifier hs-var">urgency</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><span class="annottext">Maybe NotifyAction
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="annot"><a href="Shrun.html#printFinalResult"><span class="hs-identifier hs-type">printFinalResult</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679536133"><span class="annot"><a href="#local-6989586621679536133"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679536132"><span class="annot"><a href="#local-6989586621679536132"><span class="hs-identifier hs-type">env</span></a></span></span><span> </span><span id="local-6989586621679536131"><span class="annot"><a href="#local-6989586621679536131"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679536134"><span class="annot"><a href="#local-6989586621679536134"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="#local-6989586621679536131"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasAnyError"><span class="hs-identifier hs-type">HasAnyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536132"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommonLogging"><span class="hs-identifier hs-type">HasCommonLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536132"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasConsoleLogging"><span class="hs-identifier hs-type">HasConsoleLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536132"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536133"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasFileLogging"><span class="hs-identifier hs-type">HasFileLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536132"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasNotifyConfig"><span class="hs-identifier hs-type">HasNotifyConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536132"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><a href="Shrun.Notify.MonadNotify.html#MonadNotify"><span class="hs-identifier hs-type">MonadNotify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536133"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621679536132"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536133"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#MonadRegionLogger"><span class="hs-identifier hs-type">MonadRegionLogger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536133"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#MonadSTM"><span class="hs-identifier hs-type">MonadSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536133"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-time-0.1-2d36b70ff2ff08d46ea800f2a01319f93564f934493130e6fdcee8591d088979/share/doc/html/src/Effects.Time.html#MonadTime"><span class="hs-identifier hs-type">MonadTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536133"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-219"></span><span>  </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-time-0.1-2d36b70ff2ff08d46ea800f2a01319f93564f934493130e6fdcee8591d088979/share/doc/html/src/Effects.Time.html#TimeSpec"><span class="hs-identifier hs-type">TimeSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679536131"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536134"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>  </span><span class="annot"><a href="#local-6989586621679536133"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span id="printFinalResult"><span class="annot"><span class="annottext">printFinalResult :: forall (m :: Type -&gt; Type) env e b.
(Exception e, HasAnyError env, HasCallStack, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 HasNotifyConfig env, MonadNotify m, MonadReader env m,
 MonadRegionLogger m, MonadSTM m, MonadTime m) =&gt;
TimeSpec -&gt; Either e b -&gt; m ()
</span><a href="Shrun.html#printFinalResult"><span class="hs-identifier hs-var hs-var">printFinalResult</span></a></span></span><span> </span><span id="local-6989586621679536894"><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679536894"><span class="hs-identifier hs-var">totalTime</span></a></span></span><span> </span><span id="local-6989586621679536895"><span class="annot"><span class="annottext">Either e b
</span><a href="#local-6989586621679536895"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegionLayout -&gt; (Region m -&gt; m ()) -&gt; m ()
forall a. HasCallStack =&gt; RegionLayout -&gt; (Region m -&gt; m a) -&gt; m a
forall (m :: Type -&gt; Type) a.
(MonadRegionLogger m, HasCallStack) =&gt;
RegionLayout -&gt; (Region m -&gt; m a) -&gt; m a
</span><a href="Shrun.Logging.MonadRegionLogger.html#withRegion"><span class="hs-identifier hs-var">withRegion</span></a></span><span> </span><span class="annot"><span class="annottext">RegionLayout
</span><a href="file:///nix/store/yxyj3l7g9hapmnbhjchbjsff5fqn4v74-concurrent-output-1.10.21-doc/share/doc/concurrent-output-1.10.21/html/src/System.Console.Regions.html#Linear"><span class="hs-identifier hs-var">Linear</span></a></span><span> </span><span class="annot"><span class="annottext">((Region m -&gt; m ()) -&gt; m ()) -&gt; (Region m -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679536896"><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679536896"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-223"></span><span>  </span><span class="annot"><span class="annottext">Either e b -&gt; (e -&gt; m ()) -&gt; m ()
forall (f :: Type -&gt; Type) a b.
Applicative f =&gt;
Either a b -&gt; (a -&gt; f ()) -&gt; f ()
</span><a href="Shrun.Utils.html#whenLeft"><span class="hs-identifier hs-var">Utils.whenLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Either e b
</span><a href="#local-6989586621679536895"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">((e -&gt; m ()) -&gt; m ()) -&gt; (e -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679536898"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679536898"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679536899"><span class="annot"><span class="annottext">errMsg :: UnlinedText
</span><a href="#local-6989586621679536899"><span class="hs-identifier hs-var hs-var">errMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>          </span><span class="annot"><span class="annottext">List UnlinedText -&gt; UnlinedText
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><span class="hs-string">&quot;Encountered an exception. This is likely not an error in any &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-227"></span><span>              </span><span class="annot"><span class="annottext">UnlinedText
</span><span class="hs-string">&quot;of the commands run but rather an error in Shrun itself: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-228"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#fromTextReplace"><span class="hs-identifier hs-var">ShrunText.fromTextReplace</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; UnlinedText) -&gt; Text -&gt; UnlinedText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">e -&gt; Text
forall e. Exception e =&gt; e -&gt; Text
</span><a href="Shrun.Prelude.html#displayExceptiont"><span class="hs-identifier hs-var">displayExceptiont</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679536898"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-229"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-230"></span><span>        </span><span id="local-6989586621679536902"><span class="annot"><span class="annottext">fatalLog :: Log
</span><a href="#local-6989586621679536902"><span class="hs-identifier hs-var hs-var">fatalLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-231"></span><span>          </span><span class="annot"><a href="Shrun.Logging.Types.html#MkLog"><span class="hs-identifier hs-type">MkLog</span></a></span><span>
</span><span id="line-232"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmd :: Maybe CommandP1
</span><a href="Shrun.Logging.Types.html#cmd"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CommandP1
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-233"></span><span>              </span><span class="annot"><span class="annottext">msg :: UnlinedText
</span><a href="Shrun.Logging.Types.html#msg"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><a href="#local-6989586621679536899"><span class="hs-identifier hs-var">errMsg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-234"></span><span>              </span><span class="annot"><span class="annottext">lvl :: LogLevel
</span><a href="Shrun.Logging.Types.html#lvl"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Shrun.Logging.Types.html#LevelFatal"><span class="hs-identifier hs-var">LevelFatal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-235"></span><span>              </span><span class="annot"><span class="annottext">mode :: LogMode
</span><a href="Shrun.Logging.Types.html#mode"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogMode
</span><a href="Shrun.Logging.Types.Internal.html#LogModeFinish"><span class="hs-identifier hs-var">LogModeFinish</span></a></span><span>
</span><span id="line-236"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><span class="annottext">Region m -&gt; Log -&gt; m ()
forall env (m :: Type -&gt; Type).
(HasCallStack, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 MonadReader env m, MonadSTM m, MonadTime m) =&gt;
Region m -&gt; Log -&gt; m ()
</span><a href="Shrun.Logging.html#putRegionLog"><span class="hs-identifier hs-var">Logging.putRegionLog</span></a></span><span> </span><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679536896"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Log
</span><a href="#local-6989586621679536902"><span class="hs-identifier hs-var">fatalLog</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-comment">-- update anyError</span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><span class="annottext">m ()
forall env (m :: Type -&gt; Type).
(HasAnyError env, HasCallStack, MonadReader env m, MonadSTM m) =&gt;
m ()
</span><a href="Shrun.Configuration.Env.Types.html#setAnyErrorTrue"><span class="hs-identifier hs-var">setAnyErrorTrue</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>  </span><span id="local-6989586621679536903"><span class="annot"><span class="annottext">TimerFormat
</span><a href="#local-6989586621679536903"><span class="hs-identifier hs-var">timerFormat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(env -&gt; TimerFormat) -&gt; m TimerFormat
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic'
  A_Lens
  NoIx
  (Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
  TimerFormat
-&gt; Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m)))
-&gt; TimerFormat
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens
  (Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
  (Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
  ConsoleLoggingEnv
  ConsoleLoggingEnv
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Data.Tuple.Optics.html#_1"><span class="hs-identifier hs-var">_1</span></a></span><span> </span><span class="annot"><span class="annottext">Lens
  (Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
  (Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
  ConsoleLoggingEnv
  ConsoleLoggingEnv
-&gt; Optic' A_Lens NoIx ConsoleLoggingEnv TimerFormat
-&gt; Optic'
     A_Lens
     NoIx
     (Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
     TimerFormat
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Internal.Optic.html#%25"><span class="hs-operator hs-var">%</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx ConsoleLoggingEnv TimerFormat
</span><span class="">#timerFormat</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m)))
 -&gt; TimerFormat)
-&gt; (env
    -&gt; Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
-&gt; env
-&gt; TimerFormat
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall env r.
HasConsoleLogging env r =&gt;
env -&gt; Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion r))
</span><a href="Shrun.Configuration.Env.Types.html#getConsoleLogging"><span class="hs-identifier hs-var">getConsoleLogging</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536133"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679536907"><span class="annot"><span class="annottext">totalTimeTxt :: UnlinedText
</span><a href="#local-6989586621679536907"><span class="hs-identifier hs-var hs-var">totalTimeTxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>        </span><span class="annot"><span class="annottext">TimerFormat -&gt; RelativeTime -&gt; UnlinedText
</span><a href="Shrun.Configuration.Data.ConsoleLogging.TimerFormat.html#formatRelativeTime"><span class="hs-identifier hs-var">TimerFormat.formatRelativeTime</span></a></span><span>
</span><span id="line-245"></span><span>          </span><span class="annot"><span class="annottext">TimerFormat
</span><a href="#local-6989586621679536903"><span class="hs-identifier hs-var">timerFormat</span></a></span><span>
</span><span id="line-246"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeSpec -&gt; RelativeTime
</span><a href="Shrun.Utils.html#timeSpecToRelTime"><span class="hs-identifier hs-var">Utils.timeSpecToRelTime</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679536894"><span class="hs-identifier hs-var">totalTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>      </span><span id="local-6989586621679536909"><span class="annot"><span class="annottext">finalLog :: Log
</span><a href="#local-6989586621679536909"><span class="hs-identifier hs-var hs-var">finalLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>        </span><span class="annot"><a href="Shrun.Logging.Types.html#MkLog"><span class="hs-identifier hs-type">MkLog</span></a></span><span>
</span><span id="line-249"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmd :: Maybe CommandP1
</span><a href="Shrun.Logging.Types.html#cmd"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CommandP1
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-250"></span><span>            </span><span class="annot"><span class="annottext">msg :: UnlinedText
</span><a href="Shrun.Logging.Types.html#msg"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><a href="#local-6989586621679536907"><span class="hs-identifier hs-var">totalTimeTxt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-251"></span><span>            </span><span class="annot"><span class="annottext">lvl :: LogLevel
</span><a href="Shrun.Logging.Types.html#lvl"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Shrun.Logging.Types.html#LevelFinished"><span class="hs-identifier hs-var">LevelFinished</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-252"></span><span>            </span><span class="annot"><span class="annottext">mode :: LogMode
</span><a href="Shrun.Logging.Types.html#mode"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogMode
</span><a href="Shrun.Logging.Types.Internal.html#LogModeFinish"><span class="hs-identifier hs-var">LogModeFinish</span></a></span><span>
</span><span id="line-253"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-comment">-- Send off a 'finished' notification</span><span>
</span><span id="line-256"></span><span>  </span><span id="local-6989586621679536910"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679536910"><span class="hs-identifier hs-var">anyError</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar Bool -&gt; m Bool
forall (m :: Type -&gt; Type) a.
(HasCallStack, MonadSTM m) =&gt;
TVar a -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#readTVarA"><span class="hs-identifier hs-var">readTVarA</span></a></span><span> </span><span class="annot"><span class="annottext">(TVar Bool -&gt; m Bool) -&gt; m (TVar Bool) -&gt; m Bool
forall (m :: Type -&gt; Type) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(env -&gt; TVar Bool) -&gt; m (TVar Bool)
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">env -&gt; TVar Bool
forall env. HasAnyError env =&gt; env -&gt; TVar Bool
</span><a href="Shrun.Configuration.Env.Types.html#getAnyError"><span class="hs-identifier hs-var">getAnyError</span></a></span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679536911"><span class="annot"><span class="annottext">urgency :: UrgencyLevel
</span><a href="#local-6989586621679536911"><span class="hs-identifier hs-var hs-var">urgency</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679536910"><span class="hs-identifier hs-var">anyError</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">UrgencyLevel
</span><a href="file:///nix/store/kvb2yyq1yshfipcsvdmzc1iifbp4v38j-fdo-notify-0.3.1-doc/share/doc/fdo-notify-0.3.1/html/src/DBus.Notify.html#Critical"><span class="hs-identifier hs-var">Critical</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">UrgencyLevel
</span><a href="file:///nix/store/kvb2yyq1yshfipcsvdmzc1iifbp4v38j-fdo-notify-0.3.1-doc/share/doc/fdo-notify-0.3.1/html/src/DBus.Notify.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-comment">-- Sent off notif if NotifyAll or NotifyFinal is set</span><span>
</span><span id="line-260"></span><span>  </span><span id="local-6989586621679536912"><span class="annot"><span class="annottext">Maybe NotifyEnv
</span><a href="#local-6989586621679536912"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(env -&gt; Maybe NotifyEnv) -&gt; m (Maybe NotifyEnv)
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">env -&gt; Maybe NotifyEnv
forall env. HasNotifyConfig env =&gt; env -&gt; Maybe NotifyEnv
</span><a href="Shrun.Configuration.Env.Types.html#getNotifyConfig"><span class="hs-identifier hs-var">getNotifyConfig</span></a></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe NotifyEnv
</span><a href="#local-6989586621679536912"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NotifyEnv
-&gt; Optic' An_AffineTraversal NoIx (Maybe NotifyEnv) NotifyAction
-&gt; Maybe NotifyAction
forall k s (is :: IxList) a.
Is k An_AffineFold =&gt;
s -&gt; Optic' k is s a -&gt; Maybe a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E%3F"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Prism (Maybe NotifyEnv) (Maybe NotifyEnv) NotifyEnv NotifyEnv
forall a b. Prism (Maybe a) (Maybe b) a b
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Data.Maybe.Optics.html#_Just"><span class="hs-identifier hs-var">_Just</span></a></span><span> </span><span class="annot"><span class="annottext">Prism (Maybe NotifyEnv) (Maybe NotifyEnv) NotifyEnv NotifyEnv
-&gt; Optic A_Lens NoIx NotifyEnv NotifyEnv NotifyAction NotifyAction
-&gt; Optic' An_AffineTraversal NoIx (Maybe NotifyEnv) NotifyAction
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Internal.Optic.html#%25"><span class="hs-operator hs-var">%</span></a></span><span> </span><span class="annot"><span class="annottext">Optic A_Lens NoIx NotifyEnv NotifyEnv NotifyAction NotifyAction
</span><span class="">#action</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">NotifyAction
</span><a href="Shrun.Notify.Types.html#NotifyAll"><span class="hs-identifier hs-var">NotifyAll</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnlinedText -&gt; UnlinedText -&gt; UrgencyLevel -&gt; m ()
forall env (m :: Type -&gt; Type).
(HasAnyError env, HasCallStack, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 HasNotifyConfig env, MonadNotify m, MonadReader env m,
 MonadRegionLogger m, MonadSTM m, MonadTime m) =&gt;
UnlinedText -&gt; UnlinedText -&gt; UrgencyLevel -&gt; m ()
</span><a href="Shrun.Notify.html#sendNotif"><span class="hs-identifier hs-var">Notify.sendNotif</span></a></span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><span class="hs-string">&quot;Shrun Finished&quot;</span></span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><a href="#local-6989586621679536907"><span class="hs-identifier hs-var">totalTimeTxt</span></a></span><span> </span><span class="annot"><span class="annottext">UrgencyLevel
</span><a href="#local-6989586621679536911"><span class="hs-identifier hs-var">urgency</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">NotifyAction
</span><a href="Shrun.Notify.Types.html#NotifyFinal"><span class="hs-identifier hs-var">NotifyFinal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnlinedText -&gt; UnlinedText -&gt; UrgencyLevel -&gt; m ()
forall env (m :: Type -&gt; Type).
(HasAnyError env, HasCallStack, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 HasNotifyConfig env, MonadNotify m, MonadReader env m,
 MonadRegionLogger m, MonadSTM m, MonadTime m) =&gt;
UnlinedText -&gt; UnlinedText -&gt; UrgencyLevel -&gt; m ()
</span><a href="Shrun.Notify.html#sendNotif"><span class="hs-identifier hs-var">Notify.sendNotif</span></a></span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><span class="hs-string">&quot;Shrun Finished&quot;</span></span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><a href="#local-6989586621679536907"><span class="hs-identifier hs-var">totalTimeTxt</span></a></span><span> </span><span class="annot"><span class="annottext">UrgencyLevel
</span><a href="#local-6989586621679536911"><span class="hs-identifier hs-var">urgency</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><span class="annottext">Maybe NotifyAction
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><span class="annottext">Region m -&gt; Log -&gt; m ()
forall env (m :: Type -&gt; Type).
(HasCallStack, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 MonadReader env m, MonadSTM m, MonadTime m) =&gt;
Region m -&gt; Log -&gt; m ()
</span><a href="Shrun.Logging.html#putRegionLog"><span class="hs-identifier hs-var">Logging.putRegionLog</span></a></span><span> </span><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679536896"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Log
</span><a href="#local-6989586621679536909"><span class="hs-identifier hs-var">finalLog</span></a></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span id="local-6989586621679536124"><span id="local-6989586621679536125"><span class="annot"><a href="Shrun.html#counter"><span class="hs-identifier hs-type">counter</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasAnyError"><span class="hs-identifier hs-type">HasAnyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536124"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommands"><span class="hs-identifier hs-type">HasCommands</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536124"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommonLogging"><span class="hs-identifier hs-type">HasCommonLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536124"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasConsoleLogging"><span class="hs-identifier hs-type">HasConsoleLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536124"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536125"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasFileLogging"><span class="hs-identifier hs-type">HasFileLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536124"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasTimeout"><span class="hs-identifier hs-type">HasTimeout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536124"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-ioref-0.1-860d8f404f53dca6781ee08a504921b2a5ad366cec6f6ee0bf36a6df9af5a101/share/doc/html/src/Effects.IORef.html#MonadIORef"><span class="hs-identifier hs-type">MonadIORef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536125"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621679536124"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536125"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#MonadRegionLogger"><span class="hs-identifier hs-type">MonadRegionLogger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536125"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-279"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#MonadSTM"><span class="hs-identifier hs-type">MonadSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536125"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-thread-0.1-11ce15cb9eb5648ab1cfa155131e7e96f8382aa643017eb72fc799e6059083e1/share/doc/html/src/Effects.Concurrent.Thread.html#MonadThread"><span class="hs-identifier hs-type">MonadThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536125"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-time-0.1-2d36b70ff2ff08d46ea800f2a01319f93564f934493130e6fdcee8591d088979/share/doc/html/src/Effects.Time.html#MonadTime"><span class="hs-identifier hs-type">MonadTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536125"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-283"></span><span>  </span><span class="annot"><a href="#local-6989586621679536125"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-284"></span><span id="counter"><span class="annot"><span class="annottext">counter :: forall env (m :: Type -&gt; Type).
(HasAnyError env, HasCallStack, HasCommands env,
 HasCommonLogging env, HasConsoleLogging env (Region m),
 HasFileLogging env, HasTimeout env, MonadIORef m,
 MonadReader env m, MonadRegionLogger m, MonadSTM m, MonadThread m,
 MonadTime m) =&gt;
m ()
</span><a href="Shrun.html#counter"><span class="hs-identifier hs-var hs-var">counter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-comment">-- HACK: This brief delay is so that our timer starts &quot;last&quot; i.e. after each</span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-comment">-- individual command. This way the running timer console region is below all</span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-comment">-- the commands' in the console.</span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><span class="annottext">Natural -&gt; m ()
forall (m :: Type -&gt; Type).
(HasCallStack, MonadThread m) =&gt;
Natural -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-thread-0.1-11ce15cb9eb5648ab1cfa155131e7e96f8382aa643017eb72fc799e6059083e1/share/doc/html/src/Effects.Concurrent.Thread.html#microsleep"><span class="hs-identifier hs-var">microsleep</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">100_000</span></span><span>
</span><span id="line-289"></span><span>  </span><span class="annot"><span class="annottext">RegionLayout -&gt; (Region m -&gt; m ()) -&gt; m ()
forall a. HasCallStack =&gt; RegionLayout -&gt; (Region m -&gt; m a) -&gt; m a
forall (m :: Type -&gt; Type) a.
(MonadRegionLogger m, HasCallStack) =&gt;
RegionLayout -&gt; (Region m -&gt; m a) -&gt; m a
</span><a href="Shrun.Logging.MonadRegionLogger.html#withRegion"><span class="hs-identifier hs-var">withRegion</span></a></span><span> </span><span class="annot"><span class="annottext">RegionLayout
</span><a href="file:///nix/store/yxyj3l7g9hapmnbhjchbjsff5fqn4v74-concurrent-output-1.10.21-doc/share/doc/concurrent-output-1.10.21/html/src/System.Console.Regions.html#Linear"><span class="hs-identifier hs-var">Linear</span></a></span><span> </span><span class="annot"><span class="annottext">((Region m -&gt; m ()) -&gt; m ()) -&gt; (Region m -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679536980"><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679536980"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>    </span><span id="local-6989586621679536981"><span class="annot"><span class="annottext">Maybe Timeout
</span><a href="#local-6989586621679536981"><span class="hs-identifier hs-var">timeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(env -&gt; Maybe Timeout) -&gt; m (Maybe Timeout)
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">env -&gt; Maybe Timeout
forall env. HasTimeout env =&gt; env -&gt; Maybe Timeout
</span><a href="Shrun.Configuration.Env.Types.html#getTimeout"><span class="hs-identifier hs-var">getTimeout</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span id="local-6989586621679536982"><span class="annot"><span class="annottext">IORef Natural
</span><a href="#local-6989586621679536982"><span class="hs-identifier hs-var">timer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; m (IORef Natural)
forall a. HasCallStack =&gt; a -&gt; m (IORef a)
forall (m :: Type -&gt; Type) a.
(MonadIORef m, HasCallStack) =&gt;
a -&gt; m (IORef a)
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-ioref-0.1-860d8f404f53dca6781ee08a504921b2a5ad366cec6f6ee0bf36a6df9af5a101/share/doc/html/src/Effects.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><span class="annottext">m Bool -&gt; m () -&gt; m ()
forall (m :: Type -&gt; Type) a. Monad m =&gt; m Bool -&gt; m a -&gt; m ()
</span><a href="Shrun.Utils.html#whileM_"><span class="hs-identifier hs-var">Utils.whileM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Region m -&gt; IORef Natural -&gt; Maybe Timeout -&gt; m Bool
forall (m :: Type -&gt; Type) env.
(HasAnyError env, HasCallStack, HasCommands env,
 HasCommonLogging env, HasConsoleLogging env (Region m),
 HasFileLogging env, MonadIORef m, MonadReader env m, MonadSTM m,
 MonadTime m) =&gt;
Region m -&gt; IORef Natural -&gt; Maybe Timeout -&gt; m Bool
</span><a href="Shrun.html#keepRunning"><span class="hs-identifier hs-var">keepRunning</span></a></span><span> </span><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679536980"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Natural
</span><a href="#local-6989586621679536982"><span class="hs-identifier hs-var">timer</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Timeout
</span><a href="#local-6989586621679536981"><span class="hs-identifier hs-var">timeout</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-293"></span><span>      </span><span class="annot"><span class="annottext">Natural -&gt; m ()
forall (m :: Type -&gt; Type).
(HasCallStack, MonadThread m) =&gt;
Natural -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-thread-0.1-11ce15cb9eb5648ab1cfa155131e7e96f8382aa643017eb72fc799e6059083e1/share/doc/html/src/Effects.Concurrent.Thread.html#sleep"><span class="hs-identifier hs-var">sleep</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span>
</span><span id="line-294"></span><span>      </span><span id="local-6989586621679536986"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679536986"><span class="hs-identifier hs-var">elapsed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Natural -&gt; (Natural -&gt; (Natural, Natural)) -&gt; m Natural
forall a b. HasCallStack =&gt; IORef a -&gt; (a -&gt; (a, b)) -&gt; m b
forall (m :: Type -&gt; Type) a b.
(MonadIORef m, HasCallStack) =&gt;
IORef a -&gt; (a -&gt; (a, b)) -&gt; m b
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-ioref-0.1-860d8f404f53dca6781ee08a504921b2a5ad366cec6f6ee0bf36a6df9af5a101/share/doc/html/src/Effects.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Natural
</span><a href="#local-6989586621679536982"><span class="hs-identifier hs-var">timer</span></a></span><span> </span><span class="annot"><span class="annottext">((Natural -&gt; (Natural, Natural)) -&gt; m Natural)
-&gt; (Natural -&gt; (Natural, Natural)) -&gt; m Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679536988"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679536988"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679536988"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679536988"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>      </span><span class="annot"><span class="annottext">Region m -&gt; Natural -&gt; m ()
forall (m :: Type -&gt; Type) env.
(HasCallStack, HasCommonLogging env,
 HasConsoleLogging env (Region m), MonadReader env m, MonadSTM m) =&gt;
Region m -&gt; Natural -&gt; m ()
</span><a href="Shrun.html#logCounter"><span class="hs-identifier hs-var">logCounter</span></a></span><span> </span><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679536980"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679536986"><span class="hs-identifier hs-var">elapsed</span></a></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="annot"><a href="Shrun.html#logCounter"><span class="hs-identifier hs-type">logCounter</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679536262"><span class="annot"><a href="#local-6989586621679536262"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679536261"><span class="annot"><a href="#local-6989586621679536261"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-300"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommonLogging"><span class="hs-identifier hs-type">HasCommonLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536261"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasConsoleLogging"><span class="hs-identifier hs-type">HasConsoleLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536261"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536262"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621679536261"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536262"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#MonadSTM"><span class="hs-identifier hs-type">MonadSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536262"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-305"></span><span>  </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536262"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-306"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-307"></span><span>  </span><span class="annot"><a href="#local-6989586621679536262"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span id="logCounter"><span class="annot"><span class="annottext">logCounter :: forall (m :: Type -&gt; Type) env.
(HasCallStack, HasCommonLogging env,
 HasConsoleLogging env (Region m), MonadReader env m, MonadSTM m) =&gt;
Region m -&gt; Natural -&gt; m ()
</span><a href="Shrun.html#logCounter"><span class="hs-identifier hs-var hs-var">logCounter</span></a></span></span><span> </span><span id="local-6989586621679537021"><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679537021"><span class="hs-identifier hs-var">region</span></a></span></span><span> </span><span id="local-6989586621679537022"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679537022"><span class="hs-identifier hs-var">elapsed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-309"></span><span>  </span><span id="local-6989586621679537023"><span class="annot"><span class="annottext">TimerFormat
</span><a href="#local-6989586621679537023"><span class="hs-identifier hs-var">timerFormat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(env -&gt; TimerFormat) -&gt; m TimerFormat
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic'
  A_Lens
  NoIx
  (Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
  TimerFormat
-&gt; Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m)))
-&gt; TimerFormat
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens
  (Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
  (Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
  ConsoleLoggingEnv
  ConsoleLoggingEnv
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Data.Tuple.Optics.html#_1"><span class="hs-identifier hs-var">_1</span></a></span><span> </span><span class="annot"><span class="annottext">Lens
  (Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
  (Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
  ConsoleLoggingEnv
  ConsoleLoggingEnv
-&gt; Optic' A_Lens NoIx ConsoleLoggingEnv TimerFormat
-&gt; Optic'
     A_Lens
     NoIx
     (Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
     TimerFormat
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Internal.Optic.html#%25"><span class="hs-operator hs-var">%</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx ConsoleLoggingEnv TimerFormat
</span><span class="">#timerFormat</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m)))
 -&gt; TimerFormat)
-&gt; (env
    -&gt; Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion (Region m))))
-&gt; env
-&gt; TimerFormat
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall env r.
HasConsoleLogging env r =&gt;
env -&gt; Tuple2 ConsoleLoggingEnv (TBQueue (LogRegion r))
</span><a href="Shrun.Configuration.Env.Types.html#getConsoleLogging"><span class="hs-identifier hs-var">getConsoleLogging</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536262"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679537024"><span class="annot"><span class="annottext">msg :: UnlinedText
</span><a href="#local-6989586621679537024"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimerFormat -&gt; Natural -&gt; UnlinedText
</span><a href="Shrun.Configuration.Data.ConsoleLogging.TimerFormat.html#formatSeconds"><span class="hs-identifier hs-var">TimerFormat.formatSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">TimerFormat
</span><a href="#local-6989586621679537023"><span class="hs-identifier hs-var">timerFormat</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679537022"><span class="hs-identifier hs-var">elapsed</span></a></span><span>
</span><span id="line-312"></span><span>      </span><span id="local-6989586621679537026"><span class="annot"><span class="annottext">lg :: Log
</span><a href="#local-6989586621679537026"><span class="hs-identifier hs-var hs-var">lg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><a href="Shrun.Logging.Types.html#MkLog"><span class="hs-identifier hs-type">MkLog</span></a></span><span>
</span><span id="line-314"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmd :: Maybe CommandP1
</span><a href="Shrun.Logging.Types.html#cmd"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CommandP1
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-315"></span><span>            </span><span class="annot"><span class="annottext">UnlinedText
msg :: UnlinedText
msg :: UnlinedText
</span><a href="Shrun.Logging.Types.html#msg"><span class="hs-identifier hs-var hs-var">msg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-316"></span><span>            </span><span class="annot"><span class="annottext">lvl :: LogLevel
</span><a href="Shrun.Logging.Types.html#lvl"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Shrun.Logging.Types.html#LevelTimer"><span class="hs-identifier hs-var">LevelTimer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-317"></span><span>            </span><span class="annot"><span class="annottext">mode :: LogMode
</span><a href="Shrun.Logging.Types.html#mode"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogMode
</span><a href="Shrun.Logging.Types.Internal.html#LogModeSet"><span class="hs-identifier hs-var">LogModeSet</span></a></span><span>
</span><span id="line-318"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-319"></span><span>  </span><span class="annot"><span class="annottext">Region m -&gt; Log -&gt; m ()
forall env (m :: Type -&gt; Type).
(HasCallStack, HasCommonLogging env,
 HasConsoleLogging env (Region m), MonadReader env m, MonadSTM m) =&gt;
Region m -&gt; Log -&gt; m ()
</span><a href="Shrun.Logging.html#regionLogToConsoleQueue"><span class="hs-identifier hs-var">Logging.regionLogToConsoleQueue</span></a></span><span> </span><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679537021"><span class="hs-identifier hs-var">region</span></a></span><span> </span><span class="annot"><span class="annottext">Log
</span><a href="#local-6989586621679537026"><span class="hs-identifier hs-var">lg</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><a href="Shrun.html#keepRunning"><span class="hs-identifier hs-type">keepRunning</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679536257"><span class="annot"><a href="#local-6989586621679536257"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679536256"><span class="annot"><a href="#local-6989586621679536256"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasAnyError"><span class="hs-identifier hs-type">HasAnyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536256"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-324"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommands"><span class="hs-identifier hs-type">HasCommands</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536256"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasCommonLogging"><span class="hs-identifier hs-type">HasCommonLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536256"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-327"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasConsoleLogging"><span class="hs-identifier hs-type">HasConsoleLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536256"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536257"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-328"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Env.Types.html#HasFileLogging"><span class="hs-identifier hs-type">HasFileLogging</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536256"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-ioref-0.1-860d8f404f53dca6781ee08a504921b2a5ad366cec6f6ee0bf36a6df9af5a101/share/doc/html/src/Effects.IORef.html#MonadIORef"><span class="hs-identifier hs-type">MonadIORef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536257"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-330"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621679536256"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536257"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-331"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#MonadSTM"><span class="hs-identifier hs-type">MonadSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536257"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-332"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-time-0.1-2d36b70ff2ff08d46ea800f2a01319f93564f934493130e6fdcee8591d088979/share/doc/html/src/Effects.Time.html#MonadTime"><span class="hs-identifier hs-type">MonadTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536257"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-334"></span><span>  </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536257"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-335"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-336"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Shrun.Configuration.Data.Core.Timeout.html#Timeout"><span class="hs-identifier hs-type">Timeout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-337"></span><span>  </span><span class="annot"><a href="#local-6989586621679536257"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-338"></span><span id="keepRunning"><span class="annot"><span class="annottext">keepRunning :: forall (m :: Type -&gt; Type) env.
(HasAnyError env, HasCallStack, HasCommands env,
 HasCommonLogging env, HasConsoleLogging env (Region m),
 HasFileLogging env, MonadIORef m, MonadReader env m, MonadSTM m,
 MonadTime m) =&gt;
Region m -&gt; IORef Natural -&gt; Maybe Timeout -&gt; m Bool
</span><a href="Shrun.html#keepRunning"><span class="hs-identifier hs-var hs-var">keepRunning</span></a></span></span><span> </span><span id="local-6989586621679537101"><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679537101"><span class="hs-identifier hs-var">region</span></a></span></span><span> </span><span id="local-6989586621679537102"><span class="annot"><span class="annottext">IORef Natural
</span><a href="#local-6989586621679537102"><span class="hs-identifier hs-var">timer</span></a></span></span><span> </span><span id="local-6989586621679537103"><span class="annot"><span class="annottext">Maybe Timeout
</span><a href="#local-6989586621679537103"><span class="hs-identifier hs-var">mto</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span>  </span><span id="local-6989586621679537104"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679537104"><span class="hs-identifier hs-var">elapsed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Natural -&gt; m Natural
forall a. HasCallStack =&gt; IORef a -&gt; m a
forall (m :: Type -&gt; Type) a.
(MonadIORef m, HasCallStack) =&gt;
IORef a -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-ioref-0.1-860d8f404f53dca6781ee08a504921b2a5ad366cec6f6ee0bf36a6df9af5a101/share/doc/html/src/Effects.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Natural
</span><a href="#local-6989586621679537102"><span class="hs-identifier hs-var">timer</span></a></span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Maybe Timeout -&gt; Bool
</span><a href="Shrun.html#timedOut"><span class="hs-identifier hs-var">timedOut</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679537104"><span class="hs-identifier hs-var">elapsed</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Timeout
</span><a href="#local-6989586621679537103"><span class="hs-identifier hs-var">mto</span></a></span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>      </span><span id="local-6989586621679537107"><span class="annot"><span class="annottext">KeyHideSwitch
</span><a href="#local-6989586621679537107"><span class="hs-identifier hs-var">keyHide</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(env -&gt; KeyHideSwitch) -&gt; m KeyHideSwitch
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic' An_Iso NoIx CommonLoggingEnv KeyHideSwitch
-&gt; CommonLoggingEnv -&gt; KeyHideSwitch
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' An_Iso NoIx CommonLoggingEnv KeyHideSwitch
</span><span class="">#keyHide</span></span><span> </span><span class="annot"><span class="annottext">(CommonLoggingEnv -&gt; KeyHideSwitch)
-&gt; (env -&gt; CommonLoggingEnv) -&gt; env -&gt; KeyHideSwitch
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">env -&gt; CommonLoggingEnv
forall env. HasCommonLogging env =&gt; env -&gt; CommonLoggingEnv
</span><a href="Shrun.Configuration.Env.Types.html#getCommonLogging"><span class="hs-identifier hs-var">getCommonLogging</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>      </span><span id="local-6989586621679537108"><span class="annot"><span class="annottext">NESeq CommandP1
</span><a href="#local-6989586621679537108"><span class="hs-identifier hs-var">allCmds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(env -&gt; NESeq CommandP1) -&gt; m (NESeq CommandP1)
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">env -&gt; NESeq CommandP1
forall env. HasCommands env =&gt; env -&gt; NESeq CommandP1
</span><a href="Shrun.Configuration.Env.Types.html#getCommands"><span class="hs-identifier hs-var">getCommands</span></a></span><span>
</span><span id="line-344"></span><span>      </span><span id="local-6989586621679537109"><span class="annot"><span class="annottext">TVar (Seq CommandP1)
</span><a href="#local-6989586621679537109"><span class="hs-identifier hs-var">completedCommandsTVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(env -&gt; TVar (Seq CommandP1)) -&gt; m (TVar (Seq CommandP1))
forall r (m :: Type -&gt; Type) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">env -&gt; TVar (Seq CommandP1)
forall env. HasCommands env =&gt; env -&gt; TVar (Seq CommandP1)
</span><a href="Shrun.Configuration.Env.Types.html#getCompletedCommands"><span class="hs-identifier hs-var">getCompletedCommands</span></a></span><span>
</span><span id="line-345"></span><span>      </span><span id="local-6989586621679537110"><span class="annot"><span class="annottext">Seq CommandP1
</span><a href="#local-6989586621679537110"><span class="hs-identifier hs-var">completedCommands</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar (Seq CommandP1) -&gt; m (Seq CommandP1)
forall (m :: Type -&gt; Type) a.
(HasCallStack, MonadSTM m) =&gt;
TVar a -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#readTVarA"><span class="hs-identifier hs-var">readTVarA</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Seq CommandP1)
</span><a href="#local-6989586621679537109"><span class="hs-identifier hs-var">completedCommandsTVar</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>      </span><span class="hs-comment">-- update anyError</span><span>
</span><span id="line-348"></span><span>      </span><span class="annot"><span class="annottext">m ()
forall env (m :: Type -&gt; Type).
(HasAnyError env, HasCallStack, MonadReader env m, MonadSTM m) =&gt;
m ()
</span><a href="Shrun.Configuration.Env.Types.html#setAnyErrorTrue"><span class="hs-identifier hs-var">setAnyErrorTrue</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679537111"><span class="annot"><span class="annottext">completedCommandsSet :: HashSet CommandP1
</span><a href="#local-6989586621679537111"><span class="hs-identifier hs-var hs-var">completedCommandsSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CommandP1] -&gt; HashSet CommandP1
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><a href="file:///nix/store/2g2ycicahw77sclmzzbrim691gxz10lw-unordered-containers-0.2.20-doc/share/doc/unordered-containers-0.2.20/html/src/Data.HashSet.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([CommandP1] -&gt; HashSet CommandP1)
-&gt; [CommandP1] -&gt; HashSet CommandP1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Seq CommandP1 -&gt; [CommandP1]
forall a. Seq a -&gt; [a]
forall (t :: Type -&gt; Type) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Seq CommandP1
</span><a href="#local-6989586621679537110"><span class="hs-identifier hs-var">completedCommands</span></a></span><span>
</span><span id="line-351"></span><span>          </span><span id="local-6989586621679537114"><span class="annot"><span class="annottext">allCmdsSet :: HashSet CommandP1
</span><a href="#local-6989586621679537114"><span class="hs-identifier hs-var hs-var">allCmdsSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CommandP1] -&gt; HashSet CommandP1
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><a href="file:///nix/store/2g2ycicahw77sclmzzbrim691gxz10lw-unordered-containers-0.2.20-doc/share/doc/unordered-containers-0.2.20/html/src/Data.HashSet.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([CommandP1] -&gt; HashSet CommandP1)
-&gt; [CommandP1] -&gt; HashSet CommandP1
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NESeq CommandP1 -&gt; [CommandP1]
forall a. NESeq a -&gt; [a]
forall (t :: Type -&gt; Type) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NESeq CommandP1
</span><a href="#local-6989586621679537108"><span class="hs-identifier hs-var">allCmds</span></a></span><span>
</span><span id="line-352"></span><span>          </span><span id="local-6989586621679537115"><span class="annot"><span class="annottext">incompleteCmds :: HashSet CommandP1
</span><a href="#local-6989586621679537115"><span class="hs-identifier hs-var hs-var">incompleteCmds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet CommandP1 -&gt; HashSet CommandP1 -&gt; HashSet CommandP1
forall a. (Eq a, Hashable a) =&gt; HashSet a -&gt; HashSet a -&gt; HashSet a
</span><a href="file:///nix/store/2g2ycicahw77sclmzzbrim691gxz10lw-unordered-containers-0.2.20-doc/share/doc/unordered-containers-0.2.20/html/src/Data.HashSet.Internal.html#difference"><span class="hs-identifier hs-var">Set.difference</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet CommandP1
</span><a href="#local-6989586621679537114"><span class="hs-identifier hs-var">allCmdsSet</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet CommandP1
</span><a href="#local-6989586621679537111"><span class="hs-identifier hs-var">completedCommandsSet</span></a></span><span>
</span><span id="line-353"></span><span>          </span><span id="local-6989586621679537117"><span class="annot"><span class="annottext">toTxtList :: List UnlinedText -&gt; CommandP1 -&gt; List UnlinedText
</span><a href="#local-6989586621679537117"><span class="hs-identifier hs-var hs-var">toTxtList</span></a></span></span><span> </span><span id="local-6989586621679537118"><span class="annot"><span class="annottext">List UnlinedText
</span><a href="#local-6989586621679537118"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679537119"><span class="annot"><span class="annottext">CommandP1
</span><a href="#local-6989586621679537119"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandP1 -&gt; KeyHideSwitch -&gt; UnlinedText
</span><a href="Shrun.Logging.Formatting.html#displayCmd"><span class="hs-identifier hs-var">LogFmt.displayCmd</span></a></span><span> </span><span class="annot"><span class="annottext">CommandP1
</span><a href="#local-6989586621679537119"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHideSwitch
</span><a href="#local-6989586621679537107"><span class="hs-identifier hs-var">keyHide</span></a></span><span> </span><span class="annot"><span class="annottext">UnlinedText -&gt; List UnlinedText -&gt; List UnlinedText
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">List UnlinedText
</span><a href="#local-6989586621679537118"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>          </span><span id="local-6989586621679537121"><span class="annot"><span class="annottext">unfinishedCmds :: UnlinedText
</span><a href="#local-6989586621679537121"><span class="hs-identifier hs-var hs-var">unfinishedCmds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-356"></span><span>            </span><span class="annot"><span class="annottext">UnlinedText -&gt; List UnlinedText -&gt; UnlinedText
</span><a href="Shrun.Data.Text.html#intercalate"><span class="hs-identifier hs-var">ShrunText.intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><span class="hs-string">&quot;, &quot;</span></span><span>
</span><span id="line-357"></span><span>              </span><span class="annot"><span class="annottext">(List UnlinedText -&gt; UnlinedText)
-&gt; List UnlinedText -&gt; UnlinedText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(List UnlinedText -&gt; CommandP1 -&gt; List UnlinedText)
-&gt; List UnlinedText -&gt; HashSet CommandP1 -&gt; List UnlinedText
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; HashSet a -&gt; b
forall (t :: Type -&gt; Type) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">List UnlinedText -&gt; CommandP1 -&gt; List UnlinedText
</span><a href="#local-6989586621679537117"><span class="hs-identifier hs-var">toTxtList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">HashSet CommandP1
</span><a href="#local-6989586621679537115"><span class="hs-identifier hs-var">incompleteCmds</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>      </span><span class="annot"><span class="annottext">Region m -&gt; Log -&gt; m ()
forall env (m :: Type -&gt; Type).
(HasCallStack, HasCommonLogging env,
 HasConsoleLogging env (Region m), HasFileLogging env,
 MonadReader env m, MonadSTM m, MonadTime m) =&gt;
Region m -&gt; Log -&gt; m ()
</span><a href="Shrun.Logging.html#putRegionLog"><span class="hs-identifier hs-var">Logging.putRegionLog</span></a></span><span> </span><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679537101"><span class="hs-identifier hs-var">region</span></a></span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="annottext">(Log -&gt; m ()) -&gt; Log -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Shrun.Logging.Types.html#MkLog"><span class="hs-identifier hs-type">MkLog</span></a></span><span>
</span><span id="line-361"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmd :: Maybe CommandP1
</span><a href="Shrun.Logging.Types.html#cmd"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CommandP1
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-362"></span><span>            </span><span class="annot"><span class="annottext">msg :: UnlinedText
</span><a href="Shrun.Logging.Types.html#msg"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><span class="hs-string">&quot;Timed out, cancelling remaining commands: &quot;</span></span><span> </span><span class="annot"><span class="annottext">UnlinedText -&gt; UnlinedText -&gt; UnlinedText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnlinedText
</span><a href="#local-6989586621679537121"><span class="hs-identifier hs-var">unfinishedCmds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-363"></span><span>            </span><span class="annot"><span class="annottext">lvl :: LogLevel
</span><a href="Shrun.Logging.Types.html#lvl"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Shrun.Logging.Types.html#LevelWarn"><span class="hs-identifier hs-var">LevelWarn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-364"></span><span>            </span><span class="annot"><span class="annottext">mode :: LogMode
</span><a href="Shrun.Logging.Types.html#mode"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogMode
</span><a href="Shrun.Logging.Types.Internal.html#LogModeFinish"><span class="hs-identifier hs-var">LogModeFinish</span></a></span><span>
</span><span id="line-365"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-366"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="annot"><a href="Shrun.html#timedOut"><span class="hs-identifier hs-type">timedOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Shrun.Configuration.Data.Core.Timeout.html#Timeout"><span class="hs-identifier hs-type">Timeout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-370"></span><span id="timedOut"><span class="annot"><span class="annottext">timedOut :: Natural -&gt; Maybe Timeout -&gt; Bool
</span><a href="Shrun.html#timedOut"><span class="hs-identifier hs-var hs-var">timedOut</span></a></span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Timeout
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-371"></span><span class="annot"><a href="Shrun.html#timedOut"><span class="hs-identifier hs-var">timedOut</span></a></span><span> </span><span id="local-6989586621679537124"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679537124"><span class="hs-identifier hs-var">timer</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Configuration.Data.Core.Timeout.html#MkTimeout"><span class="hs-identifier hs-type">MkTimeout</span></a></span><span> </span><span id="local-6989586621679537125"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679537125"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679537124"><span class="hs-identifier hs-var">timer</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679537125"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span id="local-6989586621679536047"><span id="local-6989586621679536048"><span id="local-6989586621679536049"><span class="annot"><a href="Shrun.html#pollQueueToConsole"><span class="hs-identifier hs-type">pollQueueToConsole</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-375"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679536047"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-376"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621679536048"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536047"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-377"></span><span>    </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#MonadRegionLogger"><span class="hs-identifier hs-type">MonadRegionLogger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536047"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-378"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#MonadSTM"><span class="hs-identifier hs-type">MonadSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536047"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-380"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TBQueue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.Types.html#LogRegion"><span class="hs-identifier hs-type">LogRegion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536047"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-381"></span><span>  </span><span class="annot"><a href="#local-6989586621679536047"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536049"><span class="hs-identifier hs-type">void</span></a></span></span></span></span><span>
</span><span id="line-382"></span><span id="pollQueueToConsole"><span class="annot"><span class="annottext">pollQueueToConsole :: forall (m :: Type -&gt; Type) env void.
(HasCallStack, MonadMask m, MonadReader env m, MonadRegionLogger m,
 MonadSTM m) =&gt;
TBQueue (LogRegion (Region m)) -&gt; m void
</span><a href="Shrun.html#pollQueueToConsole"><span class="hs-identifier hs-var hs-var">pollQueueToConsole</span></a></span></span><span> </span><span id="local-6989586621679537142"><span class="annot"><span class="annottext">TBQueue (LogRegion (Region m))
</span><a href="#local-6989586621679537142"><span class="hs-identifier hs-var">queue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-comment">-- NOTE: Same masking behavior as pollQueueToFile.</span><span>
</span><span id="line-384"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; m void
forall (f :: Type -&gt; Type) a b. Applicative f =&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">forever</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m void) -&gt; m () -&gt; m void
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TBQueue (LogRegion (Region m))
-&gt; (LogRegion (Region m) -&gt; m ()) -&gt; m ()
forall (m :: Type -&gt; Type) a b.
(HasCallStack, MonadMask m, MonadSTM m) =&gt;
TBQueue a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="Shrun.html#atomicReadWrite"><span class="hs-identifier hs-var">atomicReadWrite</span></a></span><span> </span><span class="annot"><span class="annottext">TBQueue (LogRegion (Region m))
</span><a href="#local-6989586621679537142"><span class="hs-identifier hs-var">queue</span></a></span><span> </span><span class="annot"><span class="annottext">LogRegion (Region m) -&gt; m ()
forall (m :: Type -&gt; Type).
(HasCallStack, MonadRegionLogger m) =&gt;
LogRegion (Region m) -&gt; m ()
</span><a href="Shrun.html#printConsoleLog"><span class="hs-identifier hs-var">printConsoleLog</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span id="local-6989586621679536061"><span class="annot"><a href="Shrun.html#printConsoleLog"><span class="hs-identifier hs-type">printConsoleLog</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-388"></span><span>    </span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#MonadRegionLogger"><span class="hs-identifier hs-type">MonadRegionLogger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536061"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><a href="Shrun.Logging.Types.html#LogRegion"><span class="hs-identifier hs-type">LogRegion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.MonadRegionLogger.html#Region"><span class="hs-identifier hs-type">Region</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536061"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-391"></span><span>  </span><span class="annot"><a href="#local-6989586621679536061"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-392"></span><span id="printConsoleLog"><span class="annot"><span class="annottext">printConsoleLog :: forall (m :: Type -&gt; Type).
(HasCallStack, MonadRegionLogger m) =&gt;
LogRegion (Region m) -&gt; m ()
</span><a href="Shrun.html#printConsoleLog"><span class="hs-identifier hs-var hs-var">printConsoleLog</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.Types.html#LogNoRegion"><span class="hs-identifier hs-type">LogNoRegion</span></a></span><span> </span><span id="local-6989586621679537169"><span class="annot"><span class="annottext">ConsoleLog
</span><a href="#local-6989586621679537169"><span class="hs-identifier hs-var">consoleLog</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m ()
forall (m :: Type -&gt; Type).
(MonadRegionLogger m, HasCallStack) =&gt;
Text -&gt; m ()
</span><a href="Shrun.Logging.MonadRegionLogger.html#logGlobal"><span class="hs-identifier hs-var">logGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConsoleLog
</span><a href="#local-6989586621679537169"><span class="hs-identifier hs-var">consoleLog</span></a></span><span> </span><span class="annot"><span class="annottext">ConsoleLog -&gt; Optic' A_Getter NoIx ConsoleLog Text -&gt; Text
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Getter NoIx ConsoleLog Text
</span><span class="">#unConsoleLog</span></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span class="annot"><a href="Shrun.html#printConsoleLog"><span class="hs-identifier hs-var">printConsoleLog</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Shrun.Logging.Types.html#LogRegion"><span class="hs-identifier hs-type">LogRegion</span></a></span><span> </span><span id="local-6989586621679537170"><span class="annot"><span class="annottext">LogMode
</span><a href="#local-6989586621679537170"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679537171"><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679537171"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679537172"><span class="annot"><span class="annottext">ConsoleLog
</span><a href="#local-6989586621679537172"><span class="hs-identifier hs-var">consoleLog</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogMode -&gt; Region m -&gt; Text -&gt; m ()
forall (m :: Type -&gt; Type).
(MonadRegionLogger m, HasCallStack) =&gt;
LogMode -&gt; Region m -&gt; Text -&gt; m ()
</span><a href="Shrun.Logging.MonadRegionLogger.html#logRegion"><span class="hs-identifier hs-var">logRegion</span></a></span><span> </span><span class="annot"><span class="annottext">LogMode
</span><a href="#local-6989586621679537170"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Region m
</span><a href="#local-6989586621679537171"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConsoleLog
</span><a href="#local-6989586621679537172"><span class="hs-identifier hs-var">consoleLog</span></a></span><span> </span><span class="annot"><span class="annottext">ConsoleLog -&gt; Optic' A_Getter NoIx ConsoleLog Text -&gt; Text
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Getter NoIx ConsoleLog Text
</span><span class="">#unConsoleLog</span></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span id="local-6989586621679536100"><span id="local-6989586621679536101"><span class="annot"><a href="Shrun.html#pollQueueToFile"><span class="hs-identifier hs-type">pollQueueToFile</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-397"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-41974851db458d24d7ece8322c69e073da21672623bf03800b727feccee8eadf/share/doc/html/src/Effects.FileSystem.HandleWriter.html#MonadHandleWriter"><span class="hs-identifier hs-type">MonadHandleWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536100"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-398"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679536100"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#MonadSTM"><span class="hs-identifier hs-type">MonadSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536100"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><a href="Shrun.Configuration.Data.FileLogging.html#FileLoggingEnv"><span class="hs-identifier hs-type">FileLoggingEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-402"></span><span>  </span><span class="annot"><a href="#local-6989586621679536100"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536101"><span class="hs-identifier hs-type">void</span></a></span></span></span><span>
</span><span id="line-403"></span><span id="pollQueueToFile"><span class="annot"><span class="annottext">pollQueueToFile :: forall (m :: Type -&gt; Type) void.
(HasCallStack, MonadHandleWriter m, MonadMask m, MonadSTM m) =&gt;
FileLoggingEnv -&gt; m void
</span><a href="Shrun.html#pollQueueToFile"><span class="hs-identifier hs-var hs-var">pollQueueToFile</span></a></span></span><span> </span><span id="local-6989586621679537197"><span class="annot"><span class="annottext">FileLoggingEnv
</span><a href="#local-6989586621679537197"><span class="hs-identifier hs-var">fileLogging</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; m void
forall (f :: Type -&gt; Type) a b. Applicative f =&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">forever</span></span><span>
</span><span id="line-405"></span><span>    </span><span class="annot"><span class="annottext">(m () -&gt; m void) -&gt; m () -&gt; m void
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-comment">-- NOTE: Read+write needs to be atomic, otherwise we can lose logs</span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-comment">-- (i.e. thread reads the log and is cancelled before it can write it).</span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-comment">-- Hence the mask.</span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><span class="annottext">TBQueue FileLog -&gt; (FileLog -&gt; m ()) -&gt; m ()
forall (m :: Type -&gt; Type) a b.
(HasCallStack, MonadMask m, MonadSTM m) =&gt;
TBQueue a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="Shrun.html#atomicReadWrite"><span class="hs-identifier hs-var">atomicReadWrite</span></a></span><span> </span><span class="annot"><span class="annottext">TBQueue FileLog
</span><a href="#local-6989586621679537198"><span class="hs-identifier hs-var">queue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle -&gt; FileLog -&gt; m ()
forall (m :: Type -&gt; Type).
(HasCallStack, MonadHandleWriter m) =&gt;
Handle -&gt; FileLog -&gt; m ()
</span><a href="Shrun.html#logFile"><span class="hs-identifier hs-var">logFile</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679537199"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-411"></span><span>    </span><span class="annot"><a href="Shrun.Configuration.Data.FileLogging.html#MkFileLogOpened"><span class="hs-identifier hs-type">MkFileLogOpened</span></a></span><span> </span><span id="local-6989586621679537199"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679537199"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679537198"><span class="annot"><span class="annottext">TBQueue FileLog
</span><a href="#local-6989586621679537198"><span class="hs-identifier hs-var">queue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FileLoggingEnv
</span><a href="#local-6989586621679537197"><span class="hs-identifier hs-var">fileLogging</span></a></span><span> </span><span class="annot"><span class="annottext">FileLoggingEnv
-&gt; Optic' A_Lens NoIx FileLoggingEnv FileLogOpened -&gt; FileLogOpened
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx FileLoggingEnv FileLogOpened
</span><span class="">#file</span></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span id="local-6989586621679536104"><span class="annot"><a href="Shrun.html#logFile"><span class="hs-identifier hs-type">logFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-41974851db458d24d7ece8322c69e073da21672623bf03800b727feccee8eadf/share/doc/html/src/Effects.FileSystem.HandleWriter.html#MonadHandleWriter"><span class="hs-identifier hs-type">MonadHandleWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536104"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Shrun.Logging.Types.Internal.html#FileLog"><span class="hs-identifier hs-type">FileLog</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679536104"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-414"></span><span id="logFile"><span class="annot"><span class="annottext">logFile :: forall (m :: Type -&gt; Type).
(HasCallStack, MonadHandleWriter m) =&gt;
Handle -&gt; FileLog -&gt; m ()
</span><a href="Shrun.html#logFile"><span class="hs-identifier hs-var hs-var">logFile</span></a></span></span><span> </span><span id="local-6989586621679537219"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679537219"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679537220"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679537220"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Text -&gt; m ()
forall (m :: Type -&gt; Type).
(HasCallStack, MonadHandleWriter m) =&gt;
Handle -&gt; Text -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-41974851db458d24d7ece8322c69e073da21672623bf03800b727feccee8eadf/share/doc/html/src/Effects.FileSystem.HandleWriter.html#hPutUtf8"><span class="hs-identifier hs-var">hPutUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679537219"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679537220"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall a b. m a -&gt; m b -&gt; m b
forall (f :: Type -&gt; Type) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; m ()
forall (m :: Type -&gt; Type).
(MonadHandleWriter m, HasCallStack) =&gt;
Handle -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-41974851db458d24d7ece8322c69e073da21672623bf03800b727feccee8eadf/share/doc/html/src/Effects.FileSystem.HandleWriter.html#hFlush"><span class="hs-identifier hs-var">hFlush</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679537219"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; (FileLog -&gt; Text) -&gt; FileLog -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Getter NoIx FileLog Text -&gt; FileLog -&gt; Text
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><a href="file:///nix/store/kpg5cmxmxp7aaby0kpg2q9k29pn7k6ng-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Getter.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Getter NoIx FileLog Text
</span><span class="">#unFileLog</span></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span class="hs-comment">-- | Reads from a queue and applies the function, if we receive a value.</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- Atomic in the sense that if a read is successful, then we will apply the</span><span>
</span><span id="line-418"></span><span class="hs-comment">-- given function, even if an async exception is raised.</span><span>
</span><span id="line-419"></span><span id="local-6989586621679536292"><span id="local-6989586621679536293"><span id="local-6989586621679536294"><span class="annot"><a href="Shrun.html#atomicReadWrite"><span class="hs-identifier hs-type">atomicReadWrite</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679536292"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-422"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#MonadSTM"><span class="hs-identifier hs-type">MonadSTM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536292"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Queue from which to read.</span></span><span>
</span><span id="line-425"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TBQueue</span></span><span> </span><span class="annot"><a href="#local-6989586621679536293"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-426"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Function to apply.</span></span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679536293"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679536292"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679536294"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-428"></span><span>  </span><span class="annot"><a href="#local-6989586621679536292"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-429"></span><span id="atomicReadWrite"><span class="annot"><span class="annottext">atomicReadWrite :: forall (m :: Type -&gt; Type) a b.
(HasCallStack, MonadMask m, MonadSTM m) =&gt;
TBQueue a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="Shrun.html#atomicReadWrite"><span class="hs-identifier hs-var hs-var">atomicReadWrite</span></a></span></span><span> </span><span id="local-6989586621679537237"><span class="annot"><span class="annottext">TBQueue a
</span><a href="#local-6989586621679537237"><span class="hs-identifier hs-var">queue</span></a></span></span><span> </span><span id="local-6989586621679537238"><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621679537238"><span class="hs-identifier hs-var">logAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-430"></span><span>  </span><span class="annot"><span class="annottext">((forall a. m a -&gt; m a) -&gt; m ()) -&gt; m ()
forall b. HasCallStack =&gt; ((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b
forall (m :: Type -&gt; Type) b.
(MonadMask m, HasCallStack) =&gt;
((forall a. m a -&gt; m a) -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">mask</span></span><span> </span><span class="annot"><span class="annottext">(((forall a. m a -&gt; m a) -&gt; m ()) -&gt; m ())
-&gt; ((forall a. m a -&gt; m a) -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679537240"><span class="annot"><span class="annottext">forall a. m a -&gt; m a
</span><a href="#local-6989586621679537240"><span class="hs-identifier hs-var">restore</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a
forall a. m a -&gt; m a
</span><a href="#local-6989586621679537240"><span class="hs-identifier hs-var">restore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TBQueue a -&gt; m a
forall (m :: Type -&gt; Type) a.
(HasCallStack, MonadSTM m) =&gt;
TBQueue a -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-stm-0.1-7ff2212c4013d17bdc0ec4628b5f9a2b075bd6564a712d7c604a27b5eb873089/share/doc/html/src/Effects.Concurrent.STM.html#readTBQueueA"><span class="hs-identifier hs-var">readTBQueueA</span></a></span><span> </span><span class="annot"><span class="annottext">TBQueue a
</span><a href="#local-6989586621679537237"><span class="hs-identifier hs-var">queue</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m ()) -&gt; m ()
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: Type -&gt; Type) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">m b -&gt; m ()
forall (f :: Type -&gt; Type) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(m b -&gt; m ()) -&gt; (a -&gt; m b) -&gt; a -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621679537238"><span class="hs-identifier hs-var">logAction</span></a></span><span>
</span><span id="line-431"></span></pre></body></html>